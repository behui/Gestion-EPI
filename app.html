<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SystÃ¨me de gestion PPVE - Casiers, Utilisateurs et Ã‰quipements centralisÃ©s">
    <meta name="keywords" content="PPVE, gestion casiers, Ã©quipements, administration">
    
    <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://www.gstatic.com">
    <link rel="canonical" href="https://behui.github.io/Gestion-EPI/app.html">
    
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://www.gstatic.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self' https://*.firebaseio.com https://*.googleapis.com; font-src 'self' data:;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    
    <title>Gestion PPVE - Application UnifiÃ©e | SystÃ¨me EPI</title>
    
    <style>
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ğŸ¨ GLOBAL STYLES
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #667eea;
            --primary-dark: #5568d3;
            --secondary: #764ba2;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --info: #3498db;
            --light: #f5f6fa;
            --dark: #2c3e50;
            --gray: #95a5a6;
            --white: #ffffff;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 30px rgba(0,0,0,0.2);
            --border-radius: 10px;
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--light);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ğŸ“Š HEADER & NAVIGATION
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .app-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: var(--white);
            padding: 15px 30px;
            box-shadow: var(--shadow-lg);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .app-title {
            font-size: 1.6em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-info-header {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-badge {
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-logout-header {
            background: rgba(255,255,255,0.2);
            color: var(--white);
            border: 2px solid var(--white);
            padding: 8px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            font-size: 0.95em;
        }

        .btn-logout-header:hover {
            background: var(--white);
            color: var(--primary);
            transform: translateY(-2px);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ğŸ”– TABS NAVIGATION
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .tabs-container {
            background: var(--white);
            box-shadow: var(--shadow);
            position: sticky;
            top: 75px;
            z-index: 999;
        }

        .tabs-nav {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            gap: 5px;
            padding: 10px 20px;
            overflow-x: auto;
        }

        .tab-button {
            background: transparent;
            border: none;
            padding: 12px 25px;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            color: var(--gray);
            transition: var(--transition);
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab-button:hover {
            background: var(--light);
            color: var(--primary);
        }

        .tab-button.active {
            background: var(--primary);
            color: var(--white);
            box-shadow: 0 -2px 10px rgba(102, 126, 234, 0.3);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ğŸ“¦ CONTENT SECTIONS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .content-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
            flex: 1;
            width: 100%;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ğŸ´ CARD COMPONENT
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light);
        }

        .card-title {
            color: var(--primary);
            font-size: 1.4em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ğŸ“ FORMS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 5px;
            color: var(--dark);
            font-weight: 500;
            font-size: 0.9em;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: var(--transition);
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ğŸ”˜ BUTTONS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-success {
            background: var(--success);
            color: var(--white);
        }

        .btn-success:hover {
            background: #27ae60;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: var(--warning);
            color: var(--white);
        }

        .btn-secondary {
            background: var(--gray);
            color: var(--white);
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           âš ï¸ ALERTS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            gap: 10px;
            font-weight: 500;
            animation: slideDown 0.3s ease;
        }

        .alert.show {
            display: flex;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid var(--success);
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid var(--danger);
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid var(--info);
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid var(--warning);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ğŸ“Š STATISTICS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: var(--white);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            margin: 10px 0;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ğŸ“± RESPONSIVE
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        @media (max-width: 768px) {
            .app-title {
                font-size: 1.2em;
            }

            .header-content {
                flex-direction: column;
                align-items: flex-start;
            }

            .tabs-nav {
                padding: 10px;
            }

            .tab-button {
                padding: 10px 15px;
                font-size: 0.9em;
            }

            .content-container {
                padding: 20px 10px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .card {
                padding: 15px;
            }

            .stat-value {
                font-size: 2em;
            }
        }

        @media (max-width: 480px) {
            .app-title span:not(:first-child) {
                display: none;
            }

            .btn {
                padding: 8px 15px;
                font-size: 0.9em;
            }

            .stat-card {
                padding: 15px;
            }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ğŸ¯ LOADING SPINNER
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: var(--white);
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ğŸ“‹ TABLE
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--white);
        }

        thead {
            background: var(--light);
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            font-weight: 600;
            color: var(--dark);
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        tr:hover {
            background: var(--light);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ğŸ­ MODAL
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            border-radius: var(--border-radius);
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: modalSlide 0.3s ease;
        }

        @keyframes modalSlide {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 20px 25px;
            border-bottom: 2px solid var(--light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.3em;
            color: var(--primary);
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: var(--gray);
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--danger);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 25px;
        }

        .modal-footer {
            padding: 20px 25px;
            border-top: 2px solid var(--light);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
    </style>
</head>
<body>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         ğŸ¯ HEADER
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <header class="app-header">
        <div class="header-content">
            <h1 class="app-title">
                <span>ğŸ¢</span>
                <span>PPVE - Gestion ComplÃ¨te</span>
            </h1>
            <div class="user-info-header">
                <div class="user-badge" id="userBadge">
                    <span>ğŸ‘¤</span>
                    <span id="userNameDisplay">Chargement...</span>
                </div>
                <button class="btn-logout-header" onclick="logout()">
                    ğŸšª DÃ©connexion
                </button>
            </div>
        </div>
    </header>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         ğŸ”– TABS NAVIGATION
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <nav class="tabs-container">
        <div class="tabs-nav">
            <button class="tab-button active" onclick="switchTab('casiers')" id="tab-btn-casiers">
                ğŸ“¦ Casiers
            </button>
            <button class="tab-button" onclick="switchTab('users')" id="tab-btn-users">
                ğŸ‘¥ Utilisateurs
            </button>
            <button class="tab-button" onclick="switchTab('equipment')" id="tab-btn-equipment">
                ğŸ­ Ã‰quipements
            </button>
        </div>
    </nav>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         ğŸ“¦ CONTENT
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <main class="content-container">
        
        <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
             ğŸ“¦ CASIERS TAB
             â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <section id="content-casiers" class="tab-content active">
            <div id="alert-casiers" class="alert"></div>

            <!-- Statistics -->
            <div class="stats-grid" id="statsGrid">
                <div class="stat-card">
                    <div class="stat-label">Total Casiers</div>
                    <div class="stat-value" id="stat-total">288</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Libres</div>
                    <div class="stat-value" id="stat-libres">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">En Attente</div>
                    <div class="stat-value" id="stat-attente">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">OccupÃ©s</div>
                    <div class="stat-value" id="stat-occupes">0</div>
                </div>
            </div>

            <!-- Filters -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">ğŸ” Filtres</h2>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Plateforme</label>
                        <select id="filter-platform" onchange="filterLockers()">
                            <option value="all">Toutes</option>
                            <option value="CI">CI (78 casiers)</option>
                            <option value="CA-A">CA-A (70 casiers)</option>
                            <option value="CA-B">CA-B (70 casiers)</option>
                            <option value="CA-C">CA-C (70 casiers)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Statut</label>
                        <select id="filter-status" onchange="filterLockers()">
                            <option value="all">Tous</option>
                            <option value="LIBRE">Libres</option>
                            <option value="EN ATTENTE">En Attente</option>
                            <option value="OCCUPÃ‰">OccupÃ©s</option>
                            <option value="INACTIF">Inactifs</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Lockers List -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">ğŸ“¦ Liste des Casiers</h2>
                    <button class="btn btn-primary" onclick="initializeLockers()">
                        ğŸ”„ RÃ©initialiser (288 casiers)
                    </button>
                </div>
                <div class="table-container">
                    <table id="lockersTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Plateforme</th>
                                <th>Statut</th>
                                <th>PrÃ©nom</th>
                                <th>Nom</th>
                                <th>Masque</th>
                                <th>Tuyau</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="lockersTableBody">
                            <tr>
                                <td colspan="9" style="text-align: center; padding: 40px;">
                                    <div class="loading-spinner"></div>
                                    <p style="margin-top: 10px;">Chargement des casiers...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
             ğŸ‘¥ USERS TAB
             â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <section id="content-users" class="tab-content">
            <div id="alert-users" class="alert"></div>

            <!-- Add User Form -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">â• CrÃ©er un Nouvel Utilisateur</h2>
                </div>
                <form id="addUserForm" onsubmit="addUser(event)">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="user-prenom">PrÃ©nom *</label>
                            <input type="text" id="user-prenom" required minlength="2" maxlength="50">
                        </div>
                        <div class="form-group">
                            <label for="user-nom">Nom *</label>
                            <input type="text" id="user-nom" required minlength="2" maxlength="50">
                        </div>
                        <div class="form-group">
                            <label for="user-email">Email *</label>
                            <input type="email" id="user-email" required>
                        </div>
                        <div class="form-group">
                            <label for="user-password">Mot de passe *</label>
                            <input type="password" id="user-password" required minlength="6">
                        </div>
                        <div class="form-group">
                            <label for="user-role">RÃ´le *</label>
                            <select id="user-role" required>
                                <option value="">-- Choisir --</option>
                                <option value="admin">ğŸ”‘ Administrateur</option>
                                <option value="utilisateur">ğŸ‘¤ Utilisateur</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success">
                        â• CrÃ©er l'utilisateur
                    </button>
                </form>
            </div>

            <!-- Users List -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">ğŸ‘¥ Liste des Utilisateurs</h2>
                    <button class="btn btn-primary" onclick="loadUsers()">
                        ğŸ”„ Actualiser
                    </button>
                </div>
                <div class="table-container">
                    <table id="usersTable">
                        <thead>
                            <tr>
                                <th>Nom Complet</th>
                                <th>Email</th>
                                <th>RÃ´le</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <tr>
                                <td colspan="4" style="text-align: center; padding: 40px;">
                                    <div class="loading-spinner"></div>
                                    <p style="margin-top: 10px;">Chargement des utilisateurs...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
             ğŸ­ EQUIPMENT TAB
             â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <section id="content-equipment" class="tab-content">
            <div id="alert-equipment" class="alert"></div>

            <!-- Equipment Stats -->
            <div class="stats-grid" id="equipmentStatsGrid">
                <div class="stat-card">
                    <div class="stat-label">Masques</div>
                    <div class="stat-value" id="stat-masques">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Tuyaux</div>
                    <div class="stat-value" id="stat-tuyaux">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Moteurs</div>
                    <div class="stat-value" id="stat-moteurs">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Batteries</div>
                    <div class="stat-value" id="stat-batteries">0</div>
                </div>
            </div>

            <!-- Equipment Tabs -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">ğŸ­ Gestion des Ã‰quipements</h2>
                </div>
                
                <div class="tabs-nav" style="padding: 0; border-bottom: 2px solid var(--light);">
                    <button class="tab-button active" onclick="switchEquipmentTab('masques')" id="equip-tab-masques">
                        ğŸ˜· Masques
                    </button>
                    <button class="tab-button" onclick="switchEquipmentTab('tuyaux')" id="equip-tab-tuyaux">
                        ğŸ”§ Tuyaux
                    </button>
                    <button class="tab-button" onclick="switchEquipmentTab('moteurs')" id="equip-tab-moteurs">
                        âš™ï¸ Moteurs
                    </button>
                    <button class="tab-button" onclick="switchEquipmentTab('batteries')" id="equip-tab-batteries">
                        ğŸ”‹ Batteries
                    </button>
                </div>

                <!-- Add Equipment Form -->
                <div style="padding: 20px 0;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">â• Ajouter un Ã©quipement</h3>
                    <form id="addEquipmentForm" onsubmit="addEquipment(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="equip-reference">RÃ©fÃ©rence *</label>
                                <input type="text" id="equip-reference" required maxlength="50">
                            </div>
                            <div class="form-group">
                                <label for="equip-numero">NumÃ©ro *</label>
                                <input type="text" id="equip-numero" required maxlength="50">
                            </div>
                            <div class="form-group">
                                <label for="equip-statut">Statut *</label>
                                <select id="equip-statut" required>
                                    <option value="EN STOCK">ğŸ“¦ En Stock</option>
                                    <option value="EN UTILISATION">ğŸ”¨ En Utilisation</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success">
                            â• Ajouter l'Ã©quipement
                        </button>
                    </form>
                </div>

                <!-- Equipment List -->
                <div class="table-container">
                    <table id="equipmentTable">
                        <thead>
                            <tr>
                                <th>RÃ©fÃ©rence</th>
                                <th>NumÃ©ro</th>
                                <th>Statut</th>
                                <th>Date RÃ©ception</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="equipmentTableBody">
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 40px;">
                                    <div class="loading-spinner"></div>
                                    <p style="margin-top: 10px;">Chargement des Ã©quipements...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

    </main>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         ğŸ”¥ FIREBASE & JAVASCRIPT
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <script type="module">
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ”§ FIREBASE CONFIGURATION (CENTRALISÃ‰E)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, doc, setDoc, getDoc, getDocs, updateDoc, deleteDoc, onSnapshot, query } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getAnalytics } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDMPBik5vpX8qOYWuhPzpJZoOLjE20pl6g",
            authDomain: "gestion-epi-4387a.firebaseapp.com",
            projectId: "gestion-epi-4387a",
            storageBucket: "gestion-epi-4387a.firebasestorage.app",
            messagingSenderId: "974706767408",
            appId: "1:974706767408:web:fde01e52a3a986d6da9ff5",
            measurementId: "G-PKNXH32P0Z"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        const db = getFirestore(app);

        console.log('âœ… Firebase initialisÃ©');

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ“š CONSTANTS (CODE QUALITY)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const LOCKER_CONFIG = {
            TOTAL: 288,
            PLATFORMS: {
                CI: 78,
                'CA-A': 70,
                'CA-B': 70,
                'CA-C': 70
            }
        };

        const LOCKER_STATUS = {
            LIBRE: 'LIBRE',
            EN_ATTENTE: 'EN ATTENTE',
            OCCUPE: 'OCCUPÃ‰',
            INACTIF: 'INACTIF'
        };

        const EQUIPMENT_STATUS = {
            EN_STOCK: 'EN STOCK',
            EN_UTILISATION: 'EN UTILISATION'
        };

        const EQUIPMENT_TYPES = {
            MASQUES: 'masques',
            TUYAUX: 'tuyaux',
            MOTEURS: 'moteurs',
            BATTERIES: 'batteries'
        };

        const MESSAGES = {
            SUCCESS: {
                LOCKER_INIT: 'âœ… 288 casiers initialisÃ©s avec succÃ¨s',
                USER_CREATED: 'âœ… Utilisateur crÃ©Ã© avec succÃ¨s',
                EQUIPMENT_ADDED: 'âœ… Ã‰quipement ajoutÃ© avec succÃ¨s',
                DATA_SAVED: 'âœ… DonnÃ©es sauvegardÃ©es'
            },
            ERROR: {
                LOAD_FAILED: 'âŒ Erreur de chargement des donnÃ©es',
                SAVE_FAILED: 'âŒ Erreur de sauvegarde',
                AUTH_FAILED: 'âŒ Erreur d\'authentification',
                VALIDATION_FAILED: 'âŒ Validation Ã©chouÃ©e'
            },
            INFO: {
                LOADING: 'â³ Chargement en cours...',
                PROCESSING: 'â³ Traitement en cours...'
            }
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ› ï¸ UTILITY FUNCTIONS (CODE QUALITY)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        /**
         * Valide un email
         * @param {string} email - L'email Ã  valider
         * @returns {boolean} true si valide
         */
        function validateEmail(email) {
            const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return regex.test(email);
        }

        /**
         * Valide un nom/prÃ©nom
         * @param {string} name - Le nom Ã  valider
         * @returns {boolean} true si valide
         */
        function validateName(name) {
            if (!name || typeof name !== 'string') return false;
            const trimmed = name.trim();
            return trimmed.length >= 2 && trimmed.length <= 50 && /^[a-zA-ZÃ€-Ã¿\s\-']+$/.test(trimmed);
        }

        /**
         * Nettoie une chaÃ®ne de caractÃ¨res
         * @param {string} str - La chaÃ®ne Ã  nettoyer
         * @returns {string} ChaÃ®ne nettoyÃ©e
         */
        function sanitizeString(str) {
            if (!str || typeof str !== 'string') return '';
            return str.trim().replace(/\s+/g, ' ');
        }

        /**
         * Formate une date au format FR
         * @param {Date|string} date - La date Ã  formater
         * @returns {string} Date formatÃ©e (DD/MM/YYYY)
         */
        function formatDate(date) {
            const d = typeof date === 'string' ? new Date(date) : date;
            if (isNaN(d.getTime())) return '';
            return d.toLocaleDateString('fr-FR', { day: '2-digit', month: '2-digit', year: 'numeric' });
        }

        /**
         * Affiche une alerte
         * @param {string} message - Le message
         * @param {string} type - Le type (success, error, info, warning)
         * @param {string} tabId - L'ID de l'onglet ('casiers', 'users', 'equipment')
         */
        function showAlert(message, type = 'info', tabId = 'casiers') {
            const alert = document.getElementById(`alert-${tabId}`);
            if (!alert) return;
            
            alert.textContent = message;
            alert.className = `alert alert-${type} show`;
            
            setTimeout(() => {
                alert.classList.remove('show');
            }, 5000);
        }

        /**
         * Log une action utilisateur
         * @param {string} action - L'action effectuÃ©e
         * @param {Object} details - DÃ©tails de l'action
         */
        function logAction(action, details) {
            console.log(`ğŸ“ [${new Date().toISOString()}] ${action}:`, details);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ” AUTHENTICATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        let currentUser = null;

        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                window.location.href = 'index.html';
                return;
            }

            currentUser = user;
            document.getElementById('userNameDisplay').textContent = user.email;
            logAction('USER_AUTHENTICATED', { email: user.email });

            // Charger les donnÃ©es initiales
            await loadInitialData();
        });

        /**
         * DÃ©connexion
         */
        window.logout = async function() {
            if (confirm('Voulez-vous vraiment vous dÃ©connecter ?')) {
                try {
                    await signOut(auth);
                    logAction('USER_LOGOUT', { email: currentUser?.email });
                    window.location.href = 'index.html';
                } catch (error) {
                    console.error('Erreur dÃ©connexion:', error);
                    showAlert('âŒ Erreur lors de la dÃ©connexion', 'error');
                }
            }
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ”– TAB MANAGEMENT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        let currentTab = 'casiers';

        /**
         * Change d'onglet principal
         * @param {string} tabName - Nom de l'onglet
         */
        window.switchTab = function(tabName) {
            // Cacher tous les contenus
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // DÃ©sactiver tous les boutons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // Activer le contenu et bouton sÃ©lectionnÃ©s
            document.getElementById(`content-${tabName}`).classList.add('active');
            document.getElementById(`tab-btn-${tabName}`).classList.add('active');

            currentTab = tabName;
            logAction('TAB_SWITCHED', { tab: tabName });

            // Charger les donnÃ©es spÃ©cifiques si nÃ©cessaire
            if (tabName === 'users') {
                loadUsers();
            } else if (tabName === 'equipment') {
                loadEquipment();
            }
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ“¦ CASIERS MANAGEMENT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        let lockersData = [];

        /**
         * Initialise 288 casiers
         */
        window.initializeLockers = async function() {
            if (!confirm('âš ï¸ Voulez-vous vraiment rÃ©initialiser les 288 casiers ? Toutes les donnÃ©es actuelles seront perdues.')) {
                return;
            }

            try {
                const lockers = [];
                
                // CI: 78 casiers (001-078)
                for (let i = 1; i <= LOCKER_CONFIG.PLATFORMS.CI; i++) {
                    lockers.push({
                        id: `CI-${String(i).padStart(3, '0')}`,
                        platform: 'CI',
                        statut: LOCKER_STATUS.LIBRE,
                        prenom: '',
                        nom: '',
                        refMasque: '',
                        refTuyau: '',
                        date: ''
                    });
                }

                // CA-A, CA-B, CA-C: 70 casiers chacun
                ['CA-A', 'CA-B', 'CA-C'].forEach(platform => {
                    for (let i = 1; i <= LOCKER_CONFIG.PLATFORMS[platform]; i++) {
                        lockers.push({
                            id: `${platform}-${String(i).padStart(3, '0')}`,
                            platform: platform,
                            statut: LOCKER_STATUS.LIBRE,
                            prenom: '',
                            nom: '',
                            refMasque: '',
                            refTuyau: '',
                            date: ''
                        });
                    }
                });

                await setDoc(doc(db, 'casiers', 'data'), {
                    lockers: lockers,
                    lastUpdate: new Date().toISOString(),
                    updatedBy: currentUser.email
                });

                showAlert(MESSAGES.SUCCESS.LOCKER_INIT, 'success', 'casiers');
                logAction('LOCKERS_INITIALIZED', { count: lockers.length });
                await loadLockers();
            } catch (error) {
                console.error('Erreur initialisation:', error);
                showAlert(MESSAGES.ERROR.SAVE_FAILED, 'error', 'casiers');
            }
        };

        /**
         * Charge les casiers depuis Firestore
         */
        async function loadLockers() {
            try {
                const docRef = doc(db, 'casiers', 'data');
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    lockersData = docSnap.data().lockers || [];
                    renderLockers();
                    updateStats();
                } else {
                    // Initialiser automatiquement si vide
                    lockersData = [];
                    renderLockers();
                }
            } catch (error) {
                console.error('Erreur chargement casiers:', error);
                showAlert(MESSAGES.ERROR.LOAD_FAILED, 'error', 'casiers');
            }
        }

        /**
         * Affiche les casiers dans le tableau
         */
        function renderLockers() {
            const tbody = document.getElementById('lockersTableBody');
            const platform = document.getElementById('filter-platform').value;
            const status = document.getElementById('filter-status').value;

            let filtered = lockersData;

            if (platform !== 'all') {
                filtered = filtered.filter(l => l.platform === platform);
            }

            if (status !== 'all') {
                filtered = filtered.filter(l => l.statut === status);
            }

            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 40px;">Aucun casier trouvÃ©</td></tr>';
                return;
            }

            tbody.innerHTML = filtered.map(locker => `
                <tr>
                    <td><strong>${locker.id}</strong></td>
                    <td>${locker.platform}</td>
                    <td>
                        <span style="
                            padding: 4px 8px;
                            border-radius: 4px;
                            font-size: 0.85em;
                            font-weight: 600;
                            background: ${getStatusColor(locker.statut)};
                            color: white;
                        ">${locker.statut}</span>
                    </td>
                    <td>${locker.prenom || '-'}</td>
                    <td>${locker.nom || '-'}</td>
                    <td>${locker.refMasque || '-'}</td>
                    <td>${locker.refTuyau || '-'}</td>
                    <td>${locker.date || '-'}</td>
                    <td>
                        <button class="btn btn-primary" style="padding: 5px 10px; font-size: 0.85em;">
                            âœï¸ Modifier
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        /**
         * Retourne la couleur selon le statut
         */
        function getStatusColor(statut) {
            switch(statut) {
                case LOCKER_STATUS.LIBRE: return '#2ecc71';
                case LOCKER_STATUS.EN_ATTENTE: return '#f39c12';
                case LOCKER_STATUS.OCCUPE: return '#e74c3c';
                case LOCKER_STATUS.INACTIF: return '#95a5a6';
                default: return '#95a5a6';
            }
        }

        /**
         * Filtre les casiers
         */
        window.filterLockers = function() {
            renderLockers();
        };

        /**
         * Met Ã  jour les statistiques
         */
        function updateStats() {
            const stats = {
                total: lockersData.length,
                libres: lockersData.filter(l => l.statut === LOCKER_STATUS.LIBRE).length,
                attente: lockersData.filter(l => l.statut === LOCKER_STATUS.EN_ATTENTE).length,
                occupes: lockersData.filter(l => l.statut === LOCKER_STATUS.OCCUPE).length
            };

            document.getElementById('stat-total').textContent = stats.total;
            document.getElementById('stat-libres').textContent = stats.libres;
            document.getElementById('stat-attente').textContent = stats.attente;
            document.getElementById('stat-occupes').textContent = stats.occupes;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ‘¥ USERS MANAGEMENT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        /**
         * Charge les utilisateurs
         */
        async function loadUsers() {
            try {
                const usersSnapshot = await getDocs(collection(db, 'users'));
                const tbody = document.getElementById('usersTableBody');

                if (usersSnapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 40px;">Aucun utilisateur trouvÃ©</td></tr>';
                    return;
                }

                tbody.innerHTML = usersSnapshot.docs.map(doc => {
                    const data = doc.data();
                    return `
                        <tr>
                            <td><strong>${data.prenom} ${data.nom}</strong></td>
                            <td>${data.email}</td>
                            <td>
                                <span style="
                                    padding: 4px 12px;
                                    border-radius: 4px;
                                    font-size: 0.85em;
                                    font-weight: 600;
                                    background: ${data.role === 'admin' ? '#667eea' : '#95a5a6'};
                                    color: white;
                                ">${data.role === 'admin' ? 'ğŸ”‘ Admin' : 'ğŸ‘¤ Utilisateur'}</span>
                            </td>
                            <td>
                                <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.85em;" onclick="deleteUser('${doc.id}', '${data.email}')">
                                    ğŸ—‘ï¸ Supprimer
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');
            } catch (error) {
                console.error('Erreur chargement utilisateurs:', error);
                showAlert(MESSAGES.ERROR.LOAD_FAILED, 'error', 'users');
            }
        }

        /**
         * Ajoute un utilisateur
         */
        window.addUser = async function(event) {
            event.preventDefault();

            const prenom = sanitizeString(document.getElementById('user-prenom').value);
            const nom = sanitizeString(document.getElementById('user-nom').value);
            const email = document.getElementById('user-email').value.trim();
            const password = document.getElementById('user-password').value;
            const role = document.getElementById('user-role').value;

            // Validation
            if (!validateName(prenom) || !validateName(nom)) {
                showAlert('âŒ PrÃ©nom et nom invalides (2-50 caractÃ¨res, lettres uniquement)', 'error', 'users');
                return;
            }

            if (!validateEmail(email)) {
                showAlert('âŒ Email invalide', 'error', 'users');
                return;
            }

            if (password.length < 6) {
                showAlert('âŒ Mot de passe trop court (min 6 caractÃ¨res)', 'error', 'users');
                return;
            }

            try {
                showAlert(MESSAGES.INFO.PROCESSING, 'info', 'users');

                // CrÃ©er l'utilisateur dans Firebase Auth
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const newUser = userCredential.user;

                // CrÃ©er le profil Firestore
                await setDoc(doc(db, 'users', newUser.uid), {
                    prenom: prenom,
                    nom: nom,
                    email: email,
                    role: role,
                    permissions: {
                        viewCasiers: true,
                        editCasiers: role === 'admin',
                        viewEquipements: true,
                        editEquipements: role === 'admin'
                    },
                    createdAt: new Date().toISOString(),
                    createdBy: currentUser.email
                });

                showAlert(MESSAGES.SUCCESS.USER_CREATED, 'success', 'users');
                logAction('USER_CREATED', { email, role });
                document.getElementById('addUserForm').reset();
                await loadUsers();
            } catch (error) {
                console.error('Erreur crÃ©ation utilisateur:', error);
                let errorMsg = MESSAGES.ERROR.SAVE_FAILED;
                if (error.code === 'auth/email-already-in-use') {
                    errorMsg = 'âŒ Cet email est dÃ©jÃ  utilisÃ©';
                }
                showAlert(errorMsg, 'error', 'users');
            }
        };

        /**
         * Supprime un utilisateur
         */
        window.deleteUser = async function(uid, email) {
            if (!confirm(`âš ï¸ Supprimer l'utilisateur ${email} ?`)) {
                return;
            }

            try {
                await deleteDoc(doc(db, 'users', uid));
                showAlert('âœ… Utilisateur supprimÃ©', 'success', 'users');
                logAction('USER_DELETED', { uid, email });
                await loadUsers();
            } catch (error) {
                console.error('Erreur suppression:', error);
                showAlert(MESSAGES.ERROR.SAVE_FAILED, 'error', 'users');
            }
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ­ EQUIPMENT MANAGEMENT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        let currentEquipmentType = EQUIPMENT_TYPES.MASQUES;
        let equipmentData = {};

        /**
         * Change d'onglet Ã©quipement
         */
        window.switchEquipmentTab = function(type) {
            currentEquipmentType = type;

            // Mettre Ã  jour les boutons
            document.querySelectorAll('[id^="equip-tab-"]').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`equip-tab-${type}`).classList.add('active');

            loadEquipment();
        };

        /**
         * Charge les Ã©quipements
         */
        async function loadEquipment() {
            try {
                const equipSnapshot = await getDocs(collection(db, currentEquipmentType));
                equipmentData[currentEquipmentType] = equipSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));

                renderEquipment();
                updateEquipmentStats();
            } catch (error) {
                console.error('Erreur chargement Ã©quipements:', error);
                showAlert(MESSAGES.ERROR.LOAD_FAILED, 'error', 'equipment');
            }
        }

        /**
         * Affiche les Ã©quipements
         */
        function renderEquipment() {
            const tbody = document.getElementById('equipmentTableBody');
            const items = equipmentData[currentEquipmentType] || [];

            if (items.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 40px;">Aucun Ã©quipement trouvÃ©</td></tr>';
                return;
            }

            tbody.innerHTML = items.map(item => `
                <tr>
                    <td><strong>${item.reference}</strong></td>
                    <td>${item.numero}</td>
                    <td>
                        <span style="
                            padding: 4px 8px;
                            border-radius: 4px;
                            font-size: 0.85em;
                            font-weight: 600;
                            background: ${item.statut === EQUIPMENT_STATUS.EN_STOCK ? '#2ecc71' : '#f39c12'};
                            color: white;
                        ">${item.statut}</span>
                    </td>
                    <td>${formatDate(item.dateReception)}</td>
                    <td>
                        <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.85em;" onclick="deleteEquipment('${item.id}')">
                            ğŸ—‘ï¸ Supprimer
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        /**
         * Ajoute un Ã©quipement
         */
        window.addEquipment = async function(event) {
            event.preventDefault();

            const reference = sanitizeString(document.getElementById('equip-reference').value);
            const numero = sanitizeString(document.getElementById('equip-numero').value);
            const statut = document.getElementById('equip-statut').value;

            if (!reference || !numero) {
                showAlert('âŒ RÃ©fÃ©rence et numÃ©ro requis', 'error', 'equipment');
                return;
            }

            try {
                const newDocRef = doc(collection(db, currentEquipmentType));
                await setDoc(newDocRef, {
                    reference: reference,
                    numero: numero,
                    statut: statut,
                    dateReception: new Date().toISOString(),
                    historique: [{
                        date: new Date().toISOString(),
                        type: 'CRÃ‰ATION',
                        description: 'Ajout initial',
                        technicien: currentUser.email
                    }]
                });

                showAlert(MESSAGES.SUCCESS.EQUIPMENT_ADDED, 'success', 'equipment');
                logAction('EQUIPMENT_ADDED', { type: currentEquipmentType, reference });
                document.getElementById('addEquipmentForm').reset();
                await loadEquipment();
            } catch (error) {
                console.error('Erreur ajout Ã©quipement:', error);
                showAlert(MESSAGES.ERROR.SAVE_FAILED, 'error', 'equipment');
            }
        };

        /**
         * Supprime un Ã©quipement
         */
        window.deleteEquipment = async function(id) {
            if (!confirm('âš ï¸ Supprimer cet Ã©quipement ?')) {
                return;
            }

            try {
                await deleteDoc(doc(db, currentEquipmentType, id));
                showAlert('âœ… Ã‰quipement supprimÃ©', 'success', 'equipment');
                logAction('EQUIPMENT_DELETED', { type: currentEquipmentType, id });
                await loadEquipment();
            } catch (error) {
                console.error('Erreur suppression:', error);
                showAlert(MESSAGES.ERROR.SAVE_FAILED, 'error', 'equipment');
            }
        };

        /**
         * Met Ã  jour les stats Ã©quipements
         */
        async function updateEquipmentStats() {
            try {
                for (const type of Object.values(EQUIPMENT_TYPES)) {
                    const snapshot = await getDocs(collection(db, type));
                    document.getElementById(`stat-${type}`).textContent = snapshot.size;
                }
            } catch (error) {
                console.error('Erreur stats Ã©quipements:', error);
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸš€ INITIALIZATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function loadInitialData() {
            try {
                await loadLockers();
                await updateEquipmentStats();
                logAction('APP_INITIALIZED', { user: currentUser.email });
            } catch (error) {
                console.error('Erreur initialisation:', error);
            }
        }

    </script>

</body>
</html>