<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Admin Tools - Centre Debug</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b 0%, #c92a2a 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 36px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .nav-bar {
            background: #f8f9fa;
            padding: 15px 30px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            border-bottom: 2px solid #e0e0e0;
        }

        .nav-btn {
            padding: 12px 24px;
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
        }

        .nav-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .content {
            padding: 30px;
        }

        .section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .section h2 {
            font-size: 24px;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #d32f2f;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.3);
        }

        .btn-warning {
            background: #ff9800;
            color: white;
        }

        .btn-warning:hover {
            background: #f57c00;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.3);
        }

        .btn-success {
            background: #4caf50;
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .btn-primary {
            background: #2196f3;
            color: white;
        }

        .btn-primary:hover {
            background: #1976d2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .log-container {
            background: #263238;
            color: #00ff00;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-entry {
            margin-bottom: 5px;
        }

        .log-error {
            color: #ff5252;
        }

        .log-success {
            color: #69f0ae;
        }

        .log-info {
            color: #40c4ff;
        }

        .log-warning {
            color: #ffd740;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .stat-value {
            font-size: 42px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }

        .danger-box {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .data-table th {
            background: #f5f5f5;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #e0e0e0;
        }

        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .badge-danger {
            background: #ffebee;
            color: #c62828;
        }

        .badge-warning {
            background: #fff3e0;
            color: #f57c00;
        }

        .back-link {
            text-align: center;
            padding: 20px;
        }

        .back-link a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            font-size: 16px;
        }

        .back-link a:hover {
            text-decoration: underline;
        }

        .config-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .config-label {
            font-weight: 600;
            color: #333;
        }

        .config-value {
            color: #666;
            font-family: 'Courier New', monospace;
        }

        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .action-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .action-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transform: translateY(-5px);
        }

        .action-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .action-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .action-description {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß Admin Tools</h1>
            <p>Centre de contr√¥le et debug Firebase</p>
        </div>

        <div class="nav-bar">
            <a href="gestion-casiers.html" class="nav-btn">üóÑÔ∏è Gestion Casiers</a>
            <a href="admin-test.html" class="nav-btn">üë• Gestion Utilisateurs</a>
            <a href="nettoyage-complet.html" class="nav-btn">üßπ Nettoyage</a>
            <a href="Antho.html" class="nav-btn">üéØ √âquipements</a>
        </div>

        <div class="content">
            <!-- Section: Vue d'ensemble -->
            <div class="section">
                <h2>üìä Vue d'ensemble du syst√®me</h2>
                <div class="section-content">
                    <button class="btn btn-success" onclick="loadSystemStats()">üîÑ Actualiser les statistiques</button>
                    <div class="stats-grid" id="systemStatsGrid">
                        <div class="stat-card">
                            <div class="stat-value" id="statLockers">-</div>
                            <div class="stat-label">Casiers</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statEquipments">-</div>
                            <div class="stat-label">√âquipements</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statUsers">-</div>
                            <div class="stat-label">Utilisateurs</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statActiveUsers">-</div>
                            <div class="stat-label">Utilisateurs Actifs</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section: Configuration Firebase -->
            <div class="section">
                <h2>‚öôÔ∏è Configuration Firebase</h2>
                <div class="section-content">
                    <div class="config-item">
                        <span class="config-label">Project ID:</span>
                        <span class="config-value">gestion-epi-4387a</span>
                    </div>
                    <div class="config-item">
                        <span class="config-label">Auth Domain:</span>
                        <span class="config-value">gestion-epi-4387a.firebaseapp.com</span>
                    </div>
                    <div class="config-item">
                        <span class="config-label">Storage Bucket:</span>
                        <span class="config-value">gestion-epi-4387a.firebasestorage.app</span>
                    </div>
                    <div class="config-item">
                        <span class="config-label">Messaging Sender ID:</span>
                        <span class="config-value">122777654308</span>
                    </div>
                    <div class="info-box">
                        <strong>‚ÑπÔ∏è Info:</strong> Configuration Firebase correctement initialis√©e
                    </div>
                </div>
            </div>

            <!-- Section: Actions rapides -->
            <div class="section">
                <h2>‚ö° Actions rapides</h2>
                <div class="section-content">
                    <div class="action-grid">
                        <div class="action-card">
                            <div class="action-icon">üîÑ</div>
                            <div class="action-title">Synchroniser les donn√©es</div>
                            <div class="action-description">Force la synchronisation de toutes les collections</div>
                            <button class="btn btn-primary" onclick="syncAllData()">Synchroniser</button>
                        </div>
                        <div class="action-card">
                            <div class="action-icon">üß™</div>
                            <div class="action-title">Test de connexion</div>
                            <div class="action-description">V√©rifie la connexion Firebase</div>
                            <button class="btn btn-primary" onclick="testConnection()">Tester</button>
                        </div>
                        <div class="action-card">
                            <div class="action-icon">üìã</div>
                            <div class="action-title">Export des donn√©es</div>
                            <div class="action-description">Exporte toutes les donn√©es en JSON</div>
                            <button class="btn btn-success" onclick="exportData()">Exporter</button>
                        </div>
                        <div class="action-card">
                            <div class="action-icon">üóëÔ∏è</div>
                            <div class="action-title">Nettoyage complet</div>
                            <div class="action-description">Acc√®s aux outils de nettoyage</div>
                            <a href="nettoyage-complet.html">
                                <button class="btn btn-warning">Ouvrir</button>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section: Debug Firebase -->
            <div class="section">
                <h2>üêõ Debug Firebase</h2>
                <div class="section-content">
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="testFirestoreRead()">Test Lecture Firestore</button>
                        <button class="btn btn-primary" onclick="testFirestoreWrite()">Test √âcriture Firestore</button>
                        <button class="btn btn-primary" onclick="testAuth()">Test Authentification</button>
                        <button class="btn btn-warning" onclick="clearLogs()">Effacer les logs</button>
                    </div>
                    <div class="log-container" id="debugLogs">
                        <div class="log-entry log-info">[INFO] Console de debug initialis√©e...</div>
                        <div class="log-entry log-info">[INFO] En attente d'actions...</div>
                    </div>
                </div>
            </div>

            <!-- Section: Permissions et S√©curit√© -->
            <div class="section">
                <h2>üîê Permissions et S√©curit√©</h2>
                <div class="section-content">
                    <div class="warning-box">
                        <strong>‚ö†Ô∏è Important:</strong> Cette page contient des outils sensibles. Assurez-vous d'avoir les permissions n√©cessaires.
                    </div>
                    <button class="btn btn-primary" onclick="checkPermissions()">V√©rifier les permissions</button>
                    <div id="permissionsContainer" style="margin-top: 15px;"></div>
                </div>
            </section>

            <!-- Section: Utilisateurs r√©cents -->
            <div class="section">
                <h2>üë• Activit√© r√©cente</h2>
                <div class="section-content">
                    <button class="btn btn-success" onclick="loadRecentActivity()">Charger l'activit√©</button>
                    <table class="data-table" id="activityTable" style="display: none;">
                        <thead>
                            <tr>
                                <th>Utilisateur</th>
                                <th>Action</th>
                                <th>Date</th>
                                <th>Statut</th>
                            </tr>
                        </thead>
                        <tbody id="activityTableBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Section: Outils de maintenance -->
            <div class="section">
                <h2>üîß Outils de maintenance</h2>
                <div class="section-content">
                    <div class="danger-box">
                        <strong>‚ö†Ô∏è DANGER:</strong> Ces actions peuvent affecter le syst√®me de mani√®re permanente.
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-warning" onclick="rebuildIndexes()">Reconstruire les index</button>
                        <button class="btn btn-warning" onclick="validateData()">Valider l'int√©grit√© des donn√©es</button>
                        <button class="btn btn-danger" onclick="resetAllPermissions()">R√©initialiser les permissions</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="back-link">
            <a href="gestion-casiers.html">‚Üê Retour √† la gestion des casiers</a>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, getDocs, addDoc, doc, setDoc, query, limit, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDmo-WSrYM_iciR5froBT_0MI8k0DVd0kk",
            authDomain: "gestion-epi-4387a.firebaseapp.com",
            projectId: "gestion-epi-4387a",
            storageBucket: "gestion-epi-4387a.firebasestorage.app",
            messagingSenderId: "122777654308",
            appId: "1:122777654308:web:4ae0b398a1f9b432d94039"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        function addLog(message, type = 'info') {
            const debugLogs = document.getElementById('debugLogs');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            const timestamp = new Date().toLocaleTimeString();
            const typeLabel = {
                'info': 'INFO',
                'success': 'SUCCESS',
                'error': 'ERROR',
                'warning': 'WARNING'
            }[type] || 'INFO';
            logEntry.textContent = `[${timestamp}] [${typeLabel}] ${message}`;
            debugLogs.appendChild(logEntry);
            debugLogs.scrollTop = debugLogs.scrollHeight;
        }

        window.clearLogs = function() {
            const debugLogs = document.getElementById('debugLogs');
            debugLogs.innerHTML = '<div class="log-entry log-info">[INFO] Logs effac√©s. En attente d\'actions...</div>';
        };

        window.loadSystemStats = async function() {
            addLog('Chargement des statistiques syst√®me...', 'info');
            
            try {
                const lockersSnapshot = await getDocs(collection(db, 'lockers'));
                document.getElementById('statLockers').textContent = lockersSnapshot.size;
                addLog(`‚úì ${lockersSnapshot.size} casiers trouv√©s`, 'success');

                const equipmentsSnapshot = await getDocs(collection(db, 'equipments'));
                document.getElementById('statEquipments').textContent = equipmentsSnapshot.size;
                addLog(`‚úì ${equipmentsSnapshot.size} √©quipements trouv√©s`, 'success');

                const usersSnapshot = await getDocs(collection(db, 'users'));
                document.getElementById('statUsers').textContent = usersSnapshot.size;
                
                let activeCount = 0;
                usersSnapshot.forEach((doc) => {
                    if (doc.data().active) activeCount++;
                });
                document.getElementById('statActiveUsers').textContent = activeCount;
                addLog(`‚úì ${usersSnapshot.size} utilisateurs (${activeCount} actifs)`, 'success');

                addLog('Statistiques charg√©es avec succ√®s', 'success');
            } catch (error) {
                console.error('Erreur:', error);
                addLog(`‚ùå Erreur lors du chargement: ${error.message}`, 'error');
            }
        };

        window.testFirestoreRead = async function() {
            addLog('Test de lecture Firestore...', 'info');
            
            try {
                const snapshot = await getDocs(collection(db, 'lockers'));
                addLog(`‚úì Lecture r√©ussie: ${snapshot.size} documents`, 'success');
            } catch (error) {
                console.error('Erreur:', error);
                addLog(`‚ùå Erreur de lecture: ${error.message}`, 'error');
            }
        };

        window.testFirestoreWrite = async function() {
            addLog('Test d\'√©criture Firestore...', 'info');
            
            try {
                const testDoc = {
                    type: 'test',
                    timestamp: new Date().toISOString(),
                    message: 'Test d\'√©criture automatique'
                };
                
                await addDoc(collection(db, 'test_logs'), testDoc);
                addLog('‚úì √âcriture r√©ussie', 'success');
            } catch (error) {
                console.error('Erreur:', error);
                addLog(`‚ùå Erreur d'√©criture: ${error.message}`, 'error');
            }
        };

        window.testAuth = function() {
            addLog('Test d\'authentification...', 'info');
            
            const user = auth.currentUser;
            if (user) {
                addLog(`‚úì Utilisateur connect√©: ${user.email}`, 'success');
                addLog(`  UID: ${user.uid}`, 'info');
            } else {
                addLog('‚ùå Aucun utilisateur connect√©', 'error');
            }
        };

        window.syncAllData = async function() {
            addLog('üîÑ Synchronisation de toutes les donn√©es...', 'info');
            
            try {
                const collections = ['lockers', 'equipments', 'users'];
                
                for (const collectionName of collections) {
                    const snapshot = await getDocs(collection(db, collectionName));
                    addLog(`‚úì ${collectionName}: ${snapshot.size} documents synchronis√©s`, 'success');
                }
                
                addLog('‚úÖ Synchronisation termin√©e', 'success');
            } catch (error) {
                console.error('Erreur:', error);
                addLog(`‚ùå Erreur de synchronisation: ${error.message}`, 'error');
            }
        };

        window.testConnection = async function() {
            addLog('üß™ Test de connexion Firebase...', 'info');
            
            try {
                // Test Firestore
                await getDocs(collection(db, 'lockers'));
                addLog('‚úì Connexion Firestore: OK', 'success');
                
                // Test Auth
                if (auth.currentUser) {
                    addLog('‚úì Authentification: OK', 'success');
                } else {
                    addLog('‚ö†Ô∏è Authentification: Aucun utilisateur connect√©', 'warning');
                }
                
                addLog('‚úÖ Tests de connexion termin√©s', 'success');
            } catch (error) {
                console.error('Erreur:', error);
                addLog(`‚ùå Erreur de connexion: ${error.message}`, 'error');
            }
        };

        window.exportData = async function() {
            addLog('üìã Export des donn√©es en cours...', 'info');
            
            try {
                const data = {
                    lockers: [],
                    equipments: [],
                    users: [],
                    exportDate: new Date().toISOString()
                };
                
                const lockersSnapshot = await getDocs(collection(db, 'lockers'));
                lockersSnapshot.forEach((doc) => {
                    data.lockers.push({ id: doc.id, ...doc.data() });
                });
                
                const equipmentsSnapshot = await getDocs(collection(db, 'equipments'));
                equipmentsSnapshot.forEach((doc) => {
                    data.equipments.push({ id: doc.id, ...doc.data() });
                });
                
                const usersSnapshot = await getDocs(collection(db, 'users'));
                usersSnapshot.forEach((doc) => {
                    data.users.push({ id: doc.id, ...doc.data() });
                });
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `gestion-epi-export-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                addLog('‚úÖ Export termin√© avec succ√®s', 'success');
            } catch (error) {
                console.error('Erreur:', error);
                addLog(`‚ùå Erreur d'export: ${error.message}`, 'error');
            }
        };

        window.checkPermissions = function() {
            addLog('üîê V√©rification des permissions...', 'info');
            
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            const permissionsContainer = document.getElementById('permissionsContainer');
            
            if (!currentUser.role) {
                addLog('‚ùå Aucune information utilisateur trouv√©e', 'error');
                return;
            }
            
            const permissions = currentUser.permissions || {};
            
            let html = '<table class="data-table"><thead><tr><th>Permission</th><th>Statut</th></tr></thead><tbody>';
            
            const permList = {
                'viewUsers': 'Voir utilisateurs',
                'editUsers': 'Modifier utilisateurs',
                'viewLockers': 'Voir casiers',
                'editCasiers': 'Modifier casiers',
                'viewEquipments': 'Voir √©quipements',
                'editEquipements': 'Modifier √©quipements'
            };
            
            for (const [key, label] of Object.entries(permList)) {
                const hasPermission = permissions[key] || false;
                const badge = hasPermission 
                    ? '<span class="badge badge-success">‚úì Autoris√©</span>'
                    : '<span class="badge badge-danger">‚úó Refus√©</span>';
                html += `<tr><td>${label}</td><td>${badge}</td></tr>`;
            }
            
            html += '</tbody></table>';
            permissionsContainer.innerHTML = html;
            
            addLog(`‚úì R√¥le: ${currentUser.role}`, 'success');
            addLog('‚úì Permissions charg√©es', 'success');
        };

        window.loadRecentActivity = function() {
            addLog('üìä Chargement de l\'activit√© r√©cente...', 'info');
            
            const activityTable = document.getElementById('activityTable');
            const activityTableBody = document.getElementById('activityTableBody');
            
            // Exemple de donn√©es (√† remplacer par de vraies donn√©es Firebase si disponibles)
            const activities = [
                { user: 'admin@example.com', action: 'Connexion', date: new Date().toLocaleString(), status: 'success' },
                { user: 'user@example.com', action: 'Modification casier', date: new Date().toLocaleString(), status: 'success' }
            ];
            
            let html = '';
            activities.forEach(activity => {
                const badgeClass = activity.status === 'success' ? 'badge-success' : 'badge-danger';
                html += `
                    <tr>
                        <td>${activity.user}</td>
                        <td>${activity.action}</td>
                        <td>${activity.date}</td>
                        <td><span class="badge ${badgeClass}">${activity.status}</span></td>
                    </tr>
                `;
            });
            
            activityTableBody.innerHTML = html;
            activityTable.style.display = 'table';
            
            addLog('‚úì Activit√© r√©cente charg√©e', 'success');
        };

        window.rebuildIndexes = function() {
            if (!confirm('Voulez-vous reconstruire les index ? Cette op√©ration peut prendre du temps.')) return;
            
            addLog('üîß Reconstruction des index...', 'warning');
            addLog('‚ö†Ô∏è Cette fonctionnalit√© n√©cessite un acc√®s backend', 'warning');
        };

        window.validateData = async function() {
            addLog('üîç Validation de l\'int√©grit√© des donn√©es...', 'info');
            
            try {
                let issues = 0;
                
                // V√©rifier les casiers
                const lockersSnapshot = await getDocs(collection(db, 'lockers'));
                lockersSnapshot.forEach((doc) => {
                    const data = doc.data();
                    if (!data.numero) {
                        addLog(`‚ö†Ô∏è Casier ${doc.id} sans num√©ro`, 'warning');
                        issues++;
                    }
                });
                
                if (issues === 0) {
                    addLog('‚úÖ Toutes les donn√©es sont valides', 'success');
                } else {
                    addLog(`‚ö†Ô∏è ${issues} probl√®me(s) d√©tect√©(s)`, 'warning');
                }
            } catch (error) {
                console.error('Erreur:', error);
                addLog(`‚ùå Erreur de validation: ${error.message}`, 'error');
            }
        };

        window.resetAllPermissions = function() {
            if (!confirm('‚ö†Ô∏è ATTENTION: Cette action r√©initialisera TOUTES les permissions. Continuer ?')) return;
            
            addLog('üîÑ R√©initialisation des permissions...', 'warning');
            addLog('‚ö†Ô∏è Cette fonctionnalit√© n√©cessite des droits administrateur avanc√©s', 'warning');
        };

        // Charger les stats au d√©marrage
        onAuthStateChanged(auth, (user) => {
            if (user) {
                addLog(`‚úì Utilisateur connect√©: ${user.email}`, 'success');
                loadSystemStats();
            } else {
                addLog('‚ùå Aucun utilisateur connect√©', 'error');
            }
        });
    </script>
</body>
</html>