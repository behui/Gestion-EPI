<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè≠ Gestion √âquipements Ventilation PPVE</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- SheetJS pour Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    
    <!-- jsPDF pour PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #667eea;
            --primary-dark: #5568d3;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --info: #3B82F6;
            --dark: #1f2937;
            --light: #f3f4f6;
            --border: #e5e7eb;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        /* LOADING SCREEN */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            color: white;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* LOGIN PAGE */
        #login-page {
            display: none;
            max-width: 450px;
            margin: 50px auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        #login-page.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header h1 {
            color: var(--primary);
            font-size: 2em;
            margin-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: var(--dark);
            font-weight: 600;
            margin-bottom: 8px;
        }

        .form-group input {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* MAIN APP */
        #app {
            display: none;
        }

        #app.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        /* HEADER */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .header-left h1 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .header-left p {
            opacity: 0.9;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            text-align: right;
        }

        .user-name {
            font-weight: 700;
            font-size: 1.1em;
        }

        .user-role {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            font-size: 0.85em;
            margin-top: 5px;
        }

        .btn-logout {
            padding: 12px 24px;
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-logout:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        /* NAVIGATION TABS */
        .nav-tabs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .nav-tab {
            padding: 18px 25px;
            background: var(--light);
            border: 3px solid transparent;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 700;
            color: var(--dark);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .nav-tab:hover {
            background: #e5e7eb;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, var(--primary) 0%, #764ba2 100%);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }

        /* DASHBOARD KPI */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-left: 5px solid var(--primary);
            transition: all 0.3s ease;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .kpi-card h3 {
            color: var(--dark);
            font-size: 0.95em;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .kpi-card .value {
            font-size: 2.5em;
            font-weight: 800;
            color: var(--primary);
        }

        /* ACTIONS BAR */
        .actions-bar {
            background: white;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            margin-bottom: 25px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        }

        .btn-secondary {
            background: var(--light);
            color: var(--dark);
        }

        .btn-secondary:hover {
            background: #e5e7eb;
            transform: translateY(-3px);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            color: white;
        }

        .btn-admin {
            background: linear-gradient(135deg, var(--primary) 0%, #764ba2 100%);
            color: white;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
        }

        .search-box input {
            width: 100%;
            padding: 14px 20px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* CONTENT GRID */
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        .form-card, .list-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .form-card h2, .list-card h2 {
            color: var(--dark);
            margin-bottom: 25px;
            font-size: 1.5em;
        }

        /* TAB CONTENT */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* EQUIPMENT LIST */
        .equipment-list {
            display: grid;
            gap: 15px;
        }

        .equipment-item {
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            padding: 20px;
            border-radius: 12px;
            border-left: 5px solid;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        .equipment-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .equipment-item.stock {
            border-left-color: var(--warning);
        }

        .equipment-item.utilisation {
            border-left-color: var(--info);
        }

        .equipment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .equipment-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .equipment-title strong {
            font-size: 1.2em;
            color: var(--dark);
        }

        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 700;
        }

        .badge.stock {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .badge.utilisation {
            background: rgba(59, 130, 246, 0.1);
            color: var(--info);
        }

        .equipment-actions {
            display: flex;
            gap: 8px;
        }

        .btn-action {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-action:hover {
            transform: scale(1.1);
        }

        .btn-utilisation {
            background: rgba(59, 130, 246, 0.1);
        }

        .btn-stock {
            background: rgba(245, 158, 11, 0.1);
        }

        .btn-delete {
            background: rgba(239, 68, 68, 0.1);
        }

        .equipment-info {
            display: grid;
            gap: 8px;
            color: #6b7280;
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }

        .modal-header h2 {
            color: var(--dark);
            font-size: 1.5em;
        }

        .close-btn {
            background: var(--light);
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: #e5e7eb;
            transform: rotate(90deg);
        }

        /* RESPONSIVE */
        @media (max-width: 1024px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }

            .header-right {
                flex-direction: column;
            }

            .nav-tabs {
                grid-template-columns: 1fr;
            }

            .dashboard {
                grid-template-columns: 1fr;
            }

            .actions-bar {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* NOTIFICATION */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 20px 30px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            z-index: 10000;
            font-weight: 700;
            animation: slideInRight 0.5s ease;
        }

        @keyframes slideInRight {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(400px); opacity: 0; }
        }

        .notification.success {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            color: white;
        }

        .notification.error {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            color: white;
        }
    </style>
</head>
<body>
    <!-- LOADING SCREEN -->
    <div id="loading-screen">
        <div class="spinner"></div>
        <h2>üîÑ Chargement de l'application...</h2>
        <p style="margin-top: 10px; opacity: 0.8;">Connexion √† Firebase en cours</p>
    </div>

    <!-- LOGIN PAGE -->
    <div id="login-page">
        <div class="login-header">
            <h1>üè≠ PPVE - Ventilation</h1>
            <p style="color: #6b7280; margin-top: 10px;">Syst√®me de gestion des √©quipements</p>
        </div>

        <form id="login-form" onsubmit="login(event)">
            <div class="form-group">
                <label>üìß Email</label>
                <input type="email" id="login-email" required placeholder="votre.email@axensgroup.com">
            </div>

            <div class="form-group">
                <label>üîí Mot de passe</label>
                <input type="password" id="login-password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>

            <button type="submit" class="btn btn-primary" style="width: 100%; font-size: 1.1em; padding: 16px;">
                üöÄ Se Connecter
            </button>
        </form>

        <div id="login-error" style="display: none; margin-top: 20px; padding: 15px; background: #fee2e2; border-radius: 10px; color: #dc2626; text-align: center; font-weight: 600;"></div>
    </div>

    <!-- MAIN APP -->
    <div id="app">
        <div class="container">
            <!-- HEADER -->
            <div class="header">
                <div class="header-left">
                    <h1>üè≠ Gestion √âquipements PPVE</h1>
                    <p>Syst√®me de suivi des masques, tuyaux et √©quipements de ventilation</p>
                </div>
                <div class="header-right">
                    <div class="user-info">
                        <div class="user-name" id="user-name">üë§ Utilisateur</div>
                        <div class="user-role" id="user-role">üîë Chargement...</div>
                    </div>
                    <button class="btn-logout" onclick="logout()">
                        üö™ D√©connexion
                    </button>
                </div>
            </div>

            <!-- NAVIGATION TABS -->
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="switchTab('masques')">
                    üé≠ MASQUES
                </button>
                <button class="nav-tab" onclick="switchTab('tuyaux')">
                    üîß TUYAUX
                </button>
                <button class="nav-tab" id="admin-tab" onclick="switchTab('admin')" style="display: none;">
                    üëë ADMINISTRATION
                </button>
                <button class="nav-tab" onclick="switchTab('stats')">
                    üìä STATISTIQUES
                </button>
            </div>

            <!-- TAB: MASQUES -->
            <div id="tab-masques" class="tab-content active">
                <!-- KPI Dashboard -->
                <div class="dashboard">
                    <div class="kpi-card">
                        <h3>üì¶ Total Masques</h3>
                        <div class="value" id="masques-total">0</div>
                    </div>
                    <div class="kpi-card" style="border-left-color: var(--warning);">
                        <h3>üü† En Stock</h3>
                        <div class="value" id="masques-stock" style="color: var(--warning);">0</div>
                    </div>
                    <div class="kpi-card" style="border-left-color: var(--info);">
                        <h3>üîµ En Utilisation</h3>
                        <div class="value" id="masques-utilisation" style="color: var(--info);">0</div>
                    </div>
                </div>

                <!-- Actions Bar -->
                <div class="actions-bar">
                    <button class="btn btn-primary" onclick="openModal('add-masque')">
                        ‚ûï Ajouter Masque
                    </button>
                    <button class="btn btn-secondary" onclick="exportToExcel('masques')">
                        üìä Export Excel
                    </button>
                    <button class="btn btn-secondary" onclick="exportToPDF('masques')">
                        üìÑ Export PDF
                    </button>
                    <div class="search-box">
                        <input type="text" id="search-masques" placeholder="üîç Rechercher un masque..." oninput="filterEquipments('masques')">
                    </div>
                </div>

                <!-- Equipment List -->
                <div class="list-card">
                    <h2>üìã Liste des Masques</h2>
                    <div id="masques-list" class="equipment-list"></div>
                </div>
            </div>

            <!-- TAB: TUYAUX -->
            <div id="tab-tuyaux" class="tab-content">
                <!-- KPI Dashboard -->
                <div class="dashboard">
                    <div class="kpi-card">
                        <h3>üì¶ Total Tuyaux</h3>
                        <div class="value" id="tuyaux-total">0</div>
                    </div>
                    <div class="kpi-card" style="border-left-color: var(--warning);">
                        <h3>üü† En Stock</h3>
                        <div class="value" id="tuyaux-stock" style="color: var(--warning);">0</div>
                    </div>
                    <div class="kpi-card" style="border-left-color: var(--info);">
                        <h3>üîµ En Utilisation</h3>
                        <div class="value" id="tuyaux-utilisation" style="color: var(--info);">0</div>
                    </div>
                </div>

                <!-- Actions Bar -->
                <div class="actions-bar">
                    <button class="btn btn-primary" onclick="openModal('add-tuyau')">
                        ‚ûï Ajouter Tuyau
                    </button>
                    <button class="btn btn-secondary" onclick="exportToExcel('tuyaux')">
                        üìä Export Excel
                    </button>
                    <button class="btn btn-secondary" onclick="exportToPDF('tuyaux')">
                        üìÑ Export PDF
                    </button>
                    <div class="search-box">
                        <input type="text" id="search-tuyaux" placeholder="üîç Rechercher un tuyau..." oninput="filterEquipments('tuyaux')">
                    </div>
                </div>

                <!-- Equipment List -->
                <div class="list-card">
                    <h2>üìã Liste des Tuyaux</h2>
                    <div id="tuyaux-list" class="equipment-list"></div>
                </div>
            </div>

            <!-- TAB: ADMIN -->
            <div id="tab-admin" class="tab-content">
                <div class="dashboard">
                    <div class="kpi-card" style="border-left-color: var(--success);">
                        <h3>üë• Utilisateurs Actifs</h3>
                        <div class="value" id="admin-users-count" style="color: var(--success);">0</div>
                    </div>
                    <div class="kpi-card" style="border-left-color: var(--info);">
                        <h3>üé≠ Total Masques</h3>
                        <div class="value" id="admin-masques-count" style="color: var(--info);">0</div>
                    </div>
                    <div class="kpi-card" style="border-left-color: var(--warning);">
                        <h3>üîß Total Tuyaux</h3>
                        <div class="value" id="admin-tuyaux-count" style="color: var(--warning);">0</div>
                    </div>
                    <div class="kpi-card" style="border-left-color: var(--danger);">
                        <h3>üîÑ Sync Status</h3>
                        <div class="value" style="color: var(--success); font-size: 1.5em;">‚úÖ Online</div>
                    </div>
                </div>

                <div class="actions-bar">
                    <button class="btn btn-admin" onclick="openModal('add-user')">
                        üë§ Ajouter Utilisateur
                    </button>
                    <button class="btn btn-secondary" onclick="backupData()">
                        üíæ Backup Complet
                    </button>
                    <button class="btn btn-secondary" onclick="repairProfiles()">
                        üîß R√©parer Profils
                    </button>
                    <button class="btn btn-danger" onclick="cleanupData()">
                        üßπ Nettoyage
                    </button>
                </div>

                <div class="list-card">
                    <h2>üë• Gestion des Utilisateurs</h2>
                    <div id="users-list" class="equipment-list"></div>
                </div>
            </div>

            <!-- TAB: STATS -->
            <div id="tab-stats" class="tab-content">
                <h2 style="margin-bottom: 30px; color: var(--dark);">üìä Statistiques & Analyses</h2>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                    <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.08);">
                        <h3 style="margin-bottom: 20px; color: var(--dark);">üé≠ R√©partition Masques</h3>
                        <canvas id="chart-masques" style="max-height: 300px;"></canvas>
                    </div>
                    <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.08);">
                        <h3 style="margin-bottom: 20px; color: var(--dark);">üîß R√©partition Tuyaux</h3>
                        <canvas id="chart-tuyaux" style="max-height: 300px;"></canvas>
                    </div>
                </div>

                <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.08);">
                    <h3 style="margin-bottom: 20px; color: var(--dark);">üìà √âvolution Globale</h3>
                    <canvas id="chart-evolution" style="max-height: 300px;"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: AJOUTER MASQUE -->
    <div id="modal-add-masque" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ûï Ajouter un Masque</h2>
                <button class="close-btn" onclick="closeModal('add-masque')">√ó</button>
            </div>
            <form id="form-add-masque" onsubmit="addEquipment('masque', event)">
                <div class="form-group">
                    <label>üìù R√©f√©rence *</label>
                    <input type="text" name="reference" required placeholder="Ex: MASK-001">
                </div>
                <div class="form-group">
                    <label>üìÖ Date d'achat *</label>
                    <input type="date" name="dateAchat" required>
                </div>
                <div class="form-group">
                    <label>üîç Date de contr√¥le</label>
                    <input type="date" name="dateControle">
                </div>
                <div class="form-group">
                    <label>üìä Statut *</label>
                    <select name="statut" required>
                        <option value="stock">üü† En Stock</option>
                        <option value="utilisation">üîµ En Utilisation</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>üìù Remarques</label>
                    <textarea name="remarques" rows="3" placeholder="Remarques optionnelles..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; font-size: 1.1em;">
                    ‚úÖ Ajouter le Masque
                </button>
            </form>
        </div>
    </div>

    <!-- MODAL: AJOUTER TUYAU -->
    <div id="modal-add-tuyau" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ûï Ajouter un Tuyau</h2>
                <button class="close-btn" onclick="closeModal('add-tuyau')">√ó</button>
            </div>
            <form id="form-add-tuyau" onsubmit="addEquipment('tuyau', event)">
                <div class="form-group">
                    <label>üìù R√©f√©rence *</label>
                    <input type="text" name="reference" required placeholder="Ex: TUY-001">
                </div>
                <div class="form-group">
                    <label>üìÖ Date d'achat *</label>
                    <input type="date" name="dateAchat" required>
                </div>
                <div class="form-group">
                    <label>üîç Date de contr√¥le</label>
                    <input type="date" name="dateControle">
                </div>
                <div class="form-group">
                    <label>üìä Statut *</label>
                    <select name="statut" required>
                        <option value="stock">üü† En Stock</option>
                        <option value="utilisation">üîµ En Utilisation</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>üìù Remarques</label>
                    <textarea name="remarques" rows="3" placeholder="Remarques optionnelles..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; font-size: 1.1em;">
                    ‚úÖ Ajouter le Tuyau
                </button>
            </form>
        </div>
    </div>

    <!-- MODAL: METTRE EN UTILISATION -->
    <div id="modal-utilisation" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üîµ Mettre en Utilisation</h2>
                <button class="close-btn" onclick="closeModal('utilisation')">√ó</button>
            </div>
            <form id="form-utilisation" onsubmit="changeStatus('utilisation', event)">
                <input type="hidden" id="utilisation-id">
                <input type="hidden" id="utilisation-type">
                
                <div class="form-group">
                    <label>üë§ Utilisateur *</label>
                    <input type="text" name="utilisateur" required placeholder="Nom de l'utilisateur">
                </div>
                <div class="form-group">
                    <label>üìÖ Date mise en service *</label>
                    <input type="date" name="dateMiseEnService" required>
                </div>
                <div class="form-group">
                    <label>üìù Remarques</label>
                    <textarea name="remarques" rows="3" placeholder="Remarques optionnelles..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; font-size: 1.1em;">
                    ‚úÖ Valider
                </button>
            </form>
        </div>
    </div>

    <!-- MODAL: REMETTRE EN STOCK -->
    <div id="modal-stock" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üü† Remettre en Stock</h2>
                <button class="close-btn" onclick="closeModal('stock')">√ó</button>
            </div>
            <form id="form-stock" onsubmit="changeStatus('stock', event)">
                <input type="hidden" id="stock-id">
                <input type="hidden" id="stock-type">
                
                <div class="form-group">
                    <label>üìÖ Date de retour *</label>
                    <input type="date" name="dateRetour" required>
                </div>
                <div class="form-group">
                    <label>üìù Remarques</label>
                    <textarea name="remarques" rows="3" placeholder="Raison du retour, √©tat..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; font-size: 1.1em;">
                    ‚úÖ Valider
                </button>
            </form>
        </div>
    </div>

    <!-- MODAL: AJOUTER UTILISATEUR -->
    <div id="modal-add-user" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üë§ Ajouter un Utilisateur</h2>
                <button class="close-btn" onclick="closeModal('add-user')">√ó</button>
            </div>
            <form id="form-add-user" onsubmit="addUser(event)">
                <div class="form-group">
                    <label>üìß Email *</label>
                    <input type="email" name="email" required placeholder="utilisateur@axensgroup.com">
                </div>
                <div class="form-group">
                    <label>üîí Mot de passe *</label>
                    <input type="password" name="password" required placeholder="Min. 6 caract√®res">
                </div>
                <div class="form-group">
                    <label>üë§ Pr√©nom *</label>
                    <input type="text" name="prenom" required placeholder="Pr√©nom">
                </div>
                <div class="form-group">
                    <label>üë§ Nom *</label>
                    <input type="text" name="nom" required placeholder="Nom">
                </div>
                <div class="form-group">
                    <label>üé≠ R√¥le *</label>
                    <select name="role" required>
                        <option value="utilisateur">üë§ Utilisateur</option>
                        <option value="admin">üîë Administrateur</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; font-size: 1.1em;">
                    ‚úÖ Cr√©er l'Utilisateur
                </button>
            </form>
        </div>
    </div>
    <script>
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üî• FIREBASE CONFIGURATION
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        const firebaseConfig = {
            apiKey: "AIzaSyDb_TiFyzWom1jXE_√´n8r38ac3UP√§d_B0c",
            authDomain: "gestion-ppve.firebaseapp.com",
            projectId: "gestion-ppve",
            storageBucket: "gestion-ppve.firebasestorage.app",
            messagingSenderId: "522024754164",
            appId: "1:522024754164:web:c5478b9ff9e2c9b8e1ba95",
            measurementId: "G-7YX2TML2E0"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üì¶ VARIABLES GLOBALES
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        let currentUser = null;
        let currentUserData = null;
        let data = {
            masques: [],
            tuyaux: [],
            users: []
        };
        let charts = {};
        let unsubscribeMasques = null;
        let unsubscribeTuyaux = null;
        let unsubscribeUsers = null;

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üîê AUTHENTICATION
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // Auth State Observer
        auth.onAuthStateChanged(async (user) => {
            console.log('üîê Auth state changed:', user ? user.email : 'No user');
            
            if (user) {
                currentUser = user;
                await loadUserProfile();
                initApp();
                hideLoading();
                showApp();
            } else {
                currentUser = null;
                currentUserData = null;
                hideLoading();
                showLogin();
            }
        });

        // Load User Profile
        async function loadUserProfile() {
            try {
                const docRef = db.collection('users').doc(currentUser.uid);
                const doc = await docRef.get();
                
                if (doc.exists) {
                    currentUserData = doc.data();
                    console.log('‚úÖ Profil charg√©:', currentUserData);
                    
                    // Update UI
                    document.getElementById('user-name').textContent = 
                        `${currentUserData.prenom} ${currentUserData.nom}`;
                    
                    const roleElement = document.getElementById('user-role');
                    if (currentUserData.role === 'admin') {
                        roleElement.textContent = 'üîë Administrateur';
                        roleElement.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                        document.getElementById('admin-tab').style.display = 'block';
                    } else {
                        roleElement.textContent = 'üë§ Utilisateur';
                        roleElement.style.background = 'linear-gradient(135deg, #3B82F6 0%, #2563EB 100%)';
                        document.getElementById('admin-tab').style.display = 'none';
                    }
                } else {
                    console.warn(‚ö†Ô∏è Profil introuvable, cr√©ation...');
                    await createUserProfile();
                }
            } catch (error) {
                console.error('‚ùå Erreur chargement profil:', error);
                showNotification('‚ùå Erreur chargement profil', 'error');
            }
        }

        // Create User Profile
        async function createUserProfile() {
            try {
                const userData = {
                    email: currentUser.email,
                    prenom: currentUser.email.split('@')[0].split('.')[0] || 'Utilisateur',
                    nom: currentUser.email.split('@')[0].split('.')[1] || '',
                    role: 'utilisateur',
                    dateCreation: firebase.firestore.FieldValue.serverTimestamp(),
                    actif: true
                };
                
                await db.collection('users').doc(currentUser.uid).set(userData);
                currentUserData = userData;
                console.log('‚úÖ Profil cr√©√©:', userData);
                showNotification('‚úÖ Profil cr√©√© avec succ√®s', 'success');
            } catch (error) {
                console.error('‚ùå Erreur cr√©ation profil:', error);
                showNotification('‚ùå Erreur cr√©ation profil', 'error');
            }
        }

        // Login Function
        async function login(event) {
            event.preventDefault();
            
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            const errorDiv = document.getElementById('login-error');
            const submitBtn = event.target.querySelector('button[type="submit"]');
            
            try {
                errorDiv.style.display = 'none';
                submitBtn.disabled = true;
                submitBtn.textContent = 'üîÑ Connexion...';
                
                await auth.signInWithEmailAndPassword(email, password);
                
                console.log('‚úÖ Connexion r√©ussie');
                showNotification('‚úÖ Connexion r√©ussie !', 'success');
                
            } catch (error) {
                console.error('‚ùå Erreur connexion:', error);
                
                let errorMessage = '‚ùå Erreur de connexion';
                switch (error.code) {
                    case 'auth/invalid-email':
                        errorMessage = '‚ùå Email invalide';
                        break;
                    case 'auth/user-disabled':
                        errorMessage = '‚ùå Compte d√©sactiv√©';
                        break;
                    case 'auth/user-not-found':
                        errorMessage = '‚ùå Utilisateur introuvable';
                        break;
                    case 'auth/wrong-password':
                        errorMessage = '‚ùå Mot de passe incorrect';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = '‚ùå Trop de tentatives. R√©essayez plus tard';
                        break;
                    default:
                        errorMessage = `‚ùå ${error.message}`;
                }
                
                errorDiv.textContent = errorMessage;
                errorDiv.style.display = 'block';
                showNotification(errorMessage, 'error');
                
                submitBtn.disabled = false;
                submitBtn.textContent = 'üöÄ Se Connecter';
            }
        }

        // Logout Function
        async function logout() {
            if (!confirm('üö™ Voulez-vous vraiment vous d√©connecter ?')) return;
            
            try {
                // Unsubscribe from listeners
                if (unsubscribeMasques) unsubscribeMasques();
                if (unsubscribeTuyaux) unsubscribeTuyaux();
                if (unsubscribeUsers) unsubscribeUsers();
                
                await auth.signOut();
                console.log('‚úÖ D√©connexion r√©ussie');
                showNotification('‚úÖ D√©connexion r√©ussie', 'success');
                
                // Reset data
                data = { masques: [], tuyaux: [], users: [] };
                
            } catch (error) {
                console.error('‚ùå Erreur d√©connexion:', error);
                showNotification('‚ùå Erreur lors de la d√©connexion', 'error');
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üöÄ APP INITIALIZATION
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function initApp() {
            console.log('üöÄ Initialisation de l\'application...');
            
            // Setup Firestore listeners
            setupFirestoreListeners();
            
            // Initialize charts
            initCharts();
            
            // Set default dates in forms
            setDefaultDates();
            
            console.log('‚úÖ Application initialis√©e');
        }

        // Setup Firestore Real-time Listeners
        function setupFirestoreListeners() {
            console.log('üëÇ Configuration des listeners Firestore...');
            
            // Listener Masques
            unsubscribeMasques = db.collection('masques')
                .orderBy('dateAjout', 'desc')
                .onSnapshot((snapshot) => {
                    data.masques = [];
                    snapshot.forEach((doc) => {
                        data.masques.push({ id: doc.id, ...doc.data() });
                    });
                    console.log(`üìä Masques charg√©s: ${data.masques.length}`);
                    updateMasquesDisplay();
                }, (error) => {
                    console.error('‚ùå Erreur listener masques:', error);
                });
            
            // Listener Tuyaux
            unsubscribeTuyaux = db.collection('tuyaux')
                .orderBy('dateAjout', 'desc')
                .onSnapshot((snapshot) => {
                    data.tuyaux = [];
                    snapshot.forEach((doc) => {
                        data.tuyaux.push({ id: doc.id, ...doc.data() });
                    });
                    console.log(`üìä Tuyaux charg√©s: ${data.tuyaux.length}`);
                    updateTuyauxDisplay();
                }, (error) => {
                    console.error('‚ùå Erreur listener tuyaux:', error);
                });
            
            // Listener Users (Admin only)
            if (currentUserData && currentUserData.role === 'admin') {
                unsubscribeUsers = db.collection('users')
                    .onSnapshot((snapshot) => {
                        data.users = [];
                        snapshot.forEach((doc) => {
                            data.users.push({ id: doc.id, ...doc.data() });
                        });
                        console.log(`üìä Utilisateurs charg√©s: ${data.users.length}`);
                        updateUsersDisplay();
                        updateAdminStats();
                    }, (error) => {
                        console.error('‚ùå Erreur listener users:', error);
                    });
            }
        }

        // Set Default Dates
        function setDefaultDates() {
            const today = new Date().toISOString().split('T')[0];
            const dateInputs = document.querySelectorAll('input[type="date"]');
            dateInputs.forEach(input => {
                if (!input.value && input.name !== 'dateControle') {
                    input.value = today;
                }
            });
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üé® UI HELPERS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function showLoading() {
            document.getElementById('loading-screen').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loading-screen').style.display = 'none';
        }

        function showLogin() {
            document.getElementById('login-page').style.display = 'flex';
            document.getElementById('app').style.display = 'none';
        }

        function showApp() {
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('app').style.display = 'block';
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.5s ease';
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }

        // Modal Functions
        function openModal(modalId) {
            document.getElementById(`modal-${modalId}`).style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(`modal-${modalId}`).style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // Tab Navigation
        function switchTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`tab-${tab}`).classList.add('active');
            
            // Update charts if stats tab
            if (tab === 'stats') {
                setTimeout(updateCharts, 100);
            }
        }

        // Format Date
        function formatDate(timestamp) {
            if (!timestamp) return 'N/A';
            
            if (timestamp.toDate) {
                return timestamp.toDate().toLocaleDateString('fr-FR');
            }
            
            if (typeof timestamp === 'string') {
                return new Date(timestamp).toLocaleDateString('fr-FR');
            }
            
            return 'N/A';
        }
    </script>
    <script>
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üìù CRUD OPERATIONS - MASQUES
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // Ajouter un masque
        async function addMasque(event) {
            event.preventDefault();
            
            const form = event.target;
            const submitBtn = form.querySelector('button[type="submit"]');
            
            try {
                submitBtn.disabled = true;
                submitBtn.textContent = '‚è≥ Ajout en cours...';
                
                const formData = new FormData(form);
                const dateOuverture = new Date(formData.get('dateOuverture'));
                const dateExpiration = new Date(dateOuverture);
                dateExpiration.setFullYear(dateExpiration.getFullYear() + 3);
                
                const masque = {
                    reference: formData.get('reference'),
                    modele: formData.get('modele'),
                    taille: formData.get('taille'),
                    nomUtilisateur: formData.get('nomUtilisateur'),
                    prenomUtilisateur: formData.get('prenomUtilisateur'),
                    dateOuverture: formData.get('dateOuverture'),
                    dateExpiration: dateExpiration.toISOString().split('T')[0],
                    dateAjout: firebase.firestore.FieldValue.serverTimestamp(),
                    statut: 'en-service',
                    remarques: formData.get('remarques') || '',
                    ajoutePar: currentUser.email,
                    historique: [{
                        action: 'Ajout',
                        date: new Date().toISOString(),
                        utilisateur: `${currentUserData.prenom} ${currentUserData.nom}`,
                        details: 'Cr√©ation du masque'
                    }]
                };
                
                await db.collection('masques').add(masque);
                
                console.log('‚úÖ Masque ajout√©:', masque);
                showNotification('‚úÖ Masque ajout√© avec succ√®s', 'success');
                
                form.reset();
                closeModal('add-masque');
                
            } catch (error) {
                console.error('‚ùå Erreur ajout masque:', error);
                showNotification('‚ùå Erreur lors de l\'ajout', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = '‚úÖ Ajouter';
            }
        }

        // Retourner un masque en stock
        async function returnMasque(masqueId) {
            try {
                const masque = data.masques.find(m => m.id === masqueId);
                if (!masque) return;
                
                document.getElementById('return-masque-id').value = masqueId;
                document.getElementById('stock-type').value = 'masque';
                document.getElementById('return-ref').textContent = masque.reference;
                document.getElementById('return-user').textContent = 
                    `${masque.prenomUtilisateur} ${masque.nomUtilisateur}`;
                
                openModal('return-stock');
                
            } catch (error) {
                console.error('‚ùå Erreur:', error);
                showNotification('‚ùå Erreur lors de l\'ouverture', 'error');
            }
        }

        // Supprimer un masque
        async function deleteMasque(masqueId) {
            const masque = data.masques.find(m => m.id === masqueId);
            if (!masque) return;
            
            if (!confirm(`üóëÔ∏è Supprimer d√©finitivement le masque "${masque.reference}" ?\n\nCette action est irr√©versible.`)) {
                return;
            }
            
            try {
                await db.collection('masques').doc(masqueId).delete();
                
                console.log('‚úÖ Masque supprim√©:', masqueId);
                showNotification('‚úÖ Masque supprim√©', 'success');
                
            } catch (error) {
                console.error('‚ùå Erreur suppression masque:', error);
                showNotification('‚ùå Erreur lors de la suppression', 'error');
            }
        }

        // Voir l'historique d'un masque
        function viewMasqueHistory(masqueId) {
            const masque = data.masques.find(m => m.id === masqueId);
            if (!masque) return;
            
            let historyHTML = `
                <div style="padding: 20px;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">
                        üìú Historique - ${masque.reference}
                    </h3>
                    <div style="background: #f9fafb; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <strong>üë§ Utilisateur actuel:</strong> ${masque.prenomUtilisateur} ${masque.nomUtilisateur}<br>
                        <strong>üìè Mod√®le:</strong> ${masque.modele} - Taille ${masque.taille}<br>
                        <strong>üìÖ Ouverture:</strong> ${formatDate(masque.dateOuverture)}<br>
                        <strong>‚è∞ Expiration:</strong> ${formatDate(masque.dateExpiration)}<br>
                        <strong>üìä Statut:</strong> ${getExpirationBadge(masque)}
                    </div>
                    <div style="max-height: 400px; overflow-y: auto;">
            `;
            
            if (masque.historique && masque.historique.length > 0) {
                masque.historique.forEach((entry, index) => {
                    historyHTML += `
                        <div style="background: white; border-left: 4px solid var(--primary); padding: 15px; margin-bottom: 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <strong style="color: var(--primary);">${entry.action}</strong>
                                <span style="color: #6b7280; font-size: 0.9em;">${formatDate(entry.date)}</span>
                            </div>
                            <div style="color: #6b7280; font-size: 0.95em;">
                                üë§ ${entry.utilisateur}<br>
                                ${entry.details ? `üìù ${entry.details}` : ''}
                            </div>
                        </div>
                    `;
                });
            } else {
                historyHTML += '<p style="text-align: center; color: #6b7280; padding: 20px;">Aucun historique disponible</p>';
            }
            
            historyHTML += '</div></div>';
            
            // Create temporary modal
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 700px;">
                    <div class="modal-header">
                        <h2>üìú Historique</h2>
                        <button class="close-btn" onclick="this.closest('.modal').remove()">√ó</button>
                    </div>
                    ${historyHTML}
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üìù CRUD OPERATIONS - TUYAUX
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // Ajouter un tuyau
        async function addTuyau(event) {
            event.preventDefault();
            
            const form = event.target;
            const submitBtn = form.querySelector('button[type="submit"]');
            
            try {
                submitBtn.disabled = true;
                submitBtn.textContent = '‚è≥ Ajout en cours...';
                
                const formData = new FormData(form);
                const dateOuverture = new Date(formData.get('dateOuverture'));
                const dateExpiration = new Date(dateOuverture);
                dateExpiration.setFullYear(dateExpiration.getFullYear() + 3);
                
                const tuyau = {
                    reference: formData.get('reference'),
                    type: formData.get('type'),
                    longueur: formData.get('longueur'),
                    diametre: formData.get('diametre'),
                    nomUtilisateur: formData.get('nomUtilisateur'),
                    prenomUtilisateur: formData.get('prenomUtilisateur'),
                    dateOuverture: formData.get('dateOuverture'),
                    dateExpiration: dateExpiration.toISOString().split('T')[0],
                    dateAjout: firebase.firestore.FieldValue.serverTimestamp(),
                    statut: 'en-service',
                    remarques: formData.get('remarques') || '',
                    ajoutePar: currentUser.email,
                    historique: [{
                        action: 'Ajout',
                        date: new Date().toISOString(),
                        utilisateur: `${currentUserData.prenom} ${currentUserData.nom}`,
                        details: 'Cr√©ation du tuyau'
                    }]
                };
                
                await db.collection('tuyaux').add(tuyau);
                
                console.log('‚úÖ Tuyau ajout√©:', tuyau);
                showNotification('‚úÖ Tuyau ajout√© avec succ√®s', 'success');
                
                form.reset();
                closeModal('add-tuyau');
                
            } catch (error) {
                console.error('‚ùå Erreur ajout tuyau:', error);
                showNotification('‚ùå Erreur lors de l\'ajout', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = '‚úÖ Ajouter';
            }
        }

        // Retourner un tuyau en stock
        async function returnTuyau(tuyauId) {
            try {
                const tuyau = data.tuyaux.find(t => t.id === tuyauId);
                if (!tuyau) return;
                
                document.getElementById('return-masque-id').value = tuyauId;
                document.getElementById('stock-type').value = 'tuyau';
                document.getElementById('return-ref').textContent = tuyau.reference;
                document.getElementById('return-user').textContent = 
                    `${tuyau.prenomUtilisateur} ${tuyau.nomUtilisateur}`;
                
                openModal('return-stock');
                
            } catch (error) {
                console.error('‚ùå Erreur:', error);
                showNotification('‚ùå Erreur lors de l\'ouverture', 'error');
            }
        }

        // Supprimer un tuyau
        async function deleteTuyau(tuyauId) {
            const tuyau = data.tuyaux.find(t => t.id === tuyauId);
            if (!tuyau) return;
            
            if (!confirm(`üóëÔ∏è Supprimer d√©finitivement le tuyau "${tuyau.reference}" ?\n\nCette action est irr√©versible.`)) {
                return;
            }
            
            try {
                await db.collection('tuyaux').doc(tuyauId).delete();
                
                console.log('‚úÖ Tuyau supprim√©:', tuyauId);
                showNotification('‚úÖ Tuyau supprim√©', 'success');
                
            } catch (error) {
                console.error('‚ùå Erreur suppression tuyau:', error);
                showNotification('‚ùå Erreur lors de la suppression', 'error');
            }
        }

        // Voir l'historique d'un tuyau
        function viewTuyauHistory(tuyauId) {
            const tuyau = data.tuyaux.find(t => t.id === tuyauId);
            if (!tuyau) return;
            
            let historyHTML = `
                <div style="padding: 20px;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">
                        üìú Historique - ${tuyau.reference}
                    </h3>
                    <div style="background: #f9fafb; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <strong>üë§ Utilisateur actuel:</strong> ${tuyau.prenomUtilisateur} ${tuyau.nomUtilisateur}<br>
                        <strong>üîß Type:</strong> ${tuyau.type} - ${tuyau.longueur}m - √ò${tuyau.diametre}mm<br>
                        <strong>üìÖ Ouverture:</strong> ${formatDate(tuyau.dateOuverture)}<br>
                        <strong>‚è∞ Expiration:</strong> ${formatDate(tuyau.dateExpiration)}<br>
                        <strong>üìä Statut:</strong> ${getExpirationBadge(tuyau)}
                    </div>
                    <div style="max-height: 400px; overflow-y: auto;">
            `;
            
            if (tuyau.historique && tuyau.historique.length > 0) {
                tuyau.historique.forEach((entry, index) => {
                    historyHTML += `
                        <div style="background: white; border-left: 4px solid var(--primary); padding: 15px; margin-bottom: 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <strong style="color: var(--primary);">${entry.action}</strong>
                                <span style="color: #6b7280; font-size: 0.9em;">${formatDate(entry.date)}</span>
                            </div>
                            <div style="color: #6b7280; font-size: 0.95em;">
                                üë§ ${entry.utilisateur}<br>
                                ${entry.details ? `üìù ${entry.details}` : ''}
                            </div>
                        </div>
                    `;
                });
            } else {
                historyHTML += '<p style="text-align: center; color: #6b7280; padding: 20px;">Aucun historique disponible</p>';
            }
            
            historyHTML += '</div></div>';
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 700px;">
                    <div class="modal-header">
                        <h2>üìú Historique</h2>
                        <button class="close-btn" onclick="this.closest('.modal').remove()">√ó</button>
                    </div>
                    ${historyHTML}
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üìù CRUD OPERATIONS - BATTERIES
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // Ajouter une batterie
        async function addBatterie(event) {
            event.preventDefault();
            
            const form = event.target;
            const submitBtn = form.querySelector('button[type="submit"]');
            
            try {
                submitBtn.disabled = true;
                submitBtn.textContent = '‚è≥ Ajout en cours...';
                
                const formData = new FormData(form);
                const dateOuverture = new Date(formData.get('dateOuverture'));
                const dateExpiration = new Date(dateOuverture);
                dateExpiration.setFullYear(dateExpiration.getFullYear() + 3);
                
                const batterie = {
                    reference: formData.get('reference'),
                    modele: formData.get('modele'),
                    capacite: formData.get('capacite'),
                    tension: formData.get('tension'),
                    nomUtilisateur: formData.get('nomUtilisateur'),
                    prenomUtilisateur: formData.get('prenomUtilisateur'),
                    dateOuverture: formData.get('dateOuverture'),
                    dateExpiration: dateExpiration.toISOString().split('T')[0],
                    dateAjout: firebase.firestore.FieldValue.serverTimestamp(),
                    statut: 'en-service',
                    remarques: formData.get('remarques') || '',
                    ajoutePar: currentUser.email,
                    historique: [{
                        action: 'Ajout',
                        date: new Date().toISOString(),
                        utilisateur: `${currentUserData.prenom} ${currentUserData.nom}`,
                        details: 'Cr√©ation de la batterie'
                    }]
                };
                
                await db.collection('batteries').add(batterie);
                
                console.log('‚úÖ Batterie ajout√©e:', batterie);
                showNotification('‚úÖ Batterie ajout√©e avec succ√®s', 'success');
                
                form.reset();
                closeModal('add-batterie');
                
            } catch (error) {
                console.error('‚ùå Erreur ajout batterie:', error);
                showNotification('‚ùå Erreur lors de l\'ajout', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = '‚úÖ Ajouter';
            }
        }

        // Retourner une batterie en stock
        async function returnBatterie(batterieId) {
            try {
                const batterie = data.batteries.find(b => b.id === batterieId);
                if (!batterie) return;
                
                document.getElementById('return-masque-id').value = batterieId;
                document.getElementById('stock-type').value = 'batterie';
                document.getElementById('return-ref').textContent = batterie.reference;
                document.getElementById('return-user').textContent = 
                    `${batterie.prenomUtilisateur} ${batterie.nomUtilisateur}`;
                
                openModal('return-stock');
                
            } catch (error) {
                console.error('‚ùå Erreur:', error);
                showNotification('‚ùå Erreur lors de l\'ouverture', 'error');
            }
        }

        // Supprimer une batterie
        async function deleteBatterie(batterieId) {
            const batterie = data.batteries.find(b => b.id === batterieId);
            if (!batterie) return;
            
            if (!confirm(`üóëÔ∏è Supprimer d√©finitivement la batterie "${batterie.reference}" ?\n\nCette action est irr√©versible.`)) {
                return;
            }
            
            try {
                await db.collection('batteries').doc(batterieId).delete();
                
                console.log('‚úÖ Batterie supprim√©e:', batterieId);
                showNotification('‚úÖ Batterie supprim√©e', 'success');
                
            } catch (error) {
                console.error('‚ùå Erreur suppression batterie:', error);
                showNotification('‚ùå Erreur lors de la suppression', 'error');
            }
        }

        // Voir l'historique d'une batterie
        function viewBatterieHistory(batterieId) {
            const batterie = data.batteries.find(b => b.id === batterieId);
            if (!batterie) return;
            
            let historyHTML = `
                <div style="padding: 20px;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">
                        üìú Historique - ${batterie.reference}
                    </h3>
                    <div style="background: #f9fafb; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <strong>üë§ Utilisateur actuel:</strong> ${batterie.prenomUtilisateur} ${batterie.nomUtilisateur}<br>
                        <strong>üîã Mod√®le:</strong> ${batterie.modele} - ${batterie.capacite}mAh - ${batterie.tension}V<br>
                        <strong>üìÖ Ouverture:</strong> ${formatDate(batterie.dateOuverture)}<br>
                        <strong>‚è∞ Expiration:</strong> ${formatDate(batterie.dateExpiration)}<br>
                        <strong>üìä Statut:</strong> ${getExpirationBadge(batterie)}
                    </div>
                    <div style="max-height: 400px; overflow-y: auto;">
            `;
            
            if (batterie.historique && batterie.historique.length > 0) {
                batterie.historique.forEach((entry, index) => {
                    historyHTML += `
                        <div style="background: white; border-left: 4px solid var(--primary); padding: 15px; margin-bottom: 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <strong style="color: var(--primary);">${entry.action}</strong>
                                <span style="color: #6b7280; font-size: 0.9em;">${formatDate(entry.date)}</span>
                            </div>
                            <div style="color: #6b7280; font-size: 0.95em;">
                                üë§ ${entry.utilisateur}<br>
                                ${entry.details ? `üìù ${entry.details}` : ''}
                            </div>
                        </div>
                    `;
                });
            } else {
                historyHTML += '<p style="text-align: center; color: #6b7280; padding: 20px;">Aucun historique disponible</p>';
            }
            
            historyHTML += '</div></div>';
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 700px;">
                    <div class="modal-header">
                        <h2>üìú Historique</h2>
                        <button class="close-btn" onclick="this.closest('.modal').remove()">√ó</button>
                    </div>
                    ${historyHTML}
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üìù CRUD OPERATIONS - MOTEURS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // Ajouter un moteur
        async function addMoteur(event) {
            event.preventDefault();
            
            const form = event.target;
            const submitBtn = form.querySelector('button[type="submit"]');
            
            try {
                submitBtn.disabled = true;
                submitBtn.textContent = '‚è≥ Ajout en cours...';
                
                const formData = new FormData(form);
                const dateOuverture = new Date(formData.get('dateOuverture'));
                const dateExpiration = new Date(dateOuverture);
                dateExpiration.setFullYear(dateExpiration.getFullYear() + 3);
                
                const moteur = {
                    reference: formData.get('reference'),
                    modele: formData.get('modele'),
                    puissance: formData.get('puissance'),
                    numeroSerie: formData.get('numeroSerie'),
                    nomUtilisateur: formData.get('nomUtilisateur'),
                    prenomUtilisateur: formData.get('prenomUtilisateur'),
                    dateOuverture: formData.get('dateOuverture'),
                    dateExpiration: dateExpiration.toISOString().split('T')[0],
                    dateAjout: firebase.firestore.FieldValue.serverTimestamp(),
                    statut: 'en-service',
                    remarques: formData.get('remarques') || '',
                    ajoutePar: currentUser.email,
                    historique: [{
                        action: 'Ajout',
                        date: new Date().toISOString(),
                        utilisateur: `${currentUserData.prenom} ${currentUserData.nom}`,
                        details: 'Cr√©ation du moteur'
                    }]
                };
                
                await db.collection('moteurs').add(moteur);
                
                console.log('‚úÖ Moteur ajout√©:', moteur);
                showNotification('‚úÖ Moteur ajout√© avec succ√®s', 'success');
                
                form.reset();
                closeModal('add-moteur');
                
            } catch (error) {
                console.error('‚ùå Erreur ajout moteur:', error);
                showNotification('‚ùå Erreur lors de l\'ajout', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = '‚úÖ Ajouter';
            }
        }

        // Retourner un moteur en stock
        async function returnMoteur(moteurId) {
            try {
                const moteur = data.moteurs.find(m => m.id === moteurId);
                if (!moteur) return;
                
                document.getElementById('return-masque-id').value = moteurId;
                document.getElementById('stock-type').value = 'moteur';
                document.getElementById('return-ref').textContent = moteur.reference;
                document.getElementById('return-user').textContent = 
                    `${moteur.prenomUtilisateur} ${moteur.nomUtilisateur}`;
                
                openModal('return-stock');
                
            } catch (error) {
                console.error('‚ùå Erreur:', error);
                showNotification('‚ùå Erreur lors de l\'ouverture', 'error');
            }
        }

        // Supprimer un moteur
        async function deleteMoteur(moteurId) {
            const moteur = data.moteurs.find(m => m.id === moteurId);
            if (!moteur) return;
            
            if (!confirm(`üóëÔ∏è Supprimer d√©finitivement le moteur "${moteur.reference}" ?\n\nCette action est irr√©versible.`)) {
                return;
            }
            
            try {
                await db.collection('moteurs').doc(moteurId).delete();
                
                console.log('‚úÖ Moteur supprim√©:', moteurId);
                showNotification('‚úÖ Moteur supprim√©', 'success');
                
            } catch (error) {
                console.error('‚ùå Erreur suppression moteur:', error);
                showNotification('‚ùå Erreur lors de la suppression', 'error');
            }
        }

        // Voir l'historique d'un moteur
        function viewMoteurHistory(moteurId) {
            const moteur = data.moteurs.find(m => m.id === moteurId);
            if (!moteur) return;
            
            let historyHTML = `
                <div style="padding: 20px;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">
                        üìú Historique - ${moteur.reference}
                    </h3>
                    <div style="background: #f9fafb; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <strong>üë§ Utilisateur actuel:</strong> ${moteur.prenomUtilisateur} ${moteur.nomUtilisateur}<br>
                        <strong>‚öôÔ∏è Mod√®le:</strong> ${moteur.modele} - ${moteur.puissance}W - N¬∞${moteur.numeroSerie}<br>
                        <strong>üìÖ Ouverture:</strong> ${formatDate(moteur.dateOuverture)}<br>
                        <strong>‚è∞ Expiration:</strong> ${formatDate(moteur.dateExpiration)}<br>
                        <strong>üìä Statut:</strong> ${getExpirationBadge(moteur)}
                    </div>
                    <div style="max-height: 400px; overflow-y: auto;">
            `;
            
            if (moteur.historique && moteur.historique.length > 0) {
                moteur.historique.forEach((entry, index) => {
                    historyHTML += `
                        <div style="background: white; border-left: 4px solid var(--primary); padding: 15px; margin-bottom: 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <strong style="color: var(--primary);">${entry.action}</strong>
                                <span style="color: #6b7280; font-size: 0.9em;">${formatDate(entry.date)}</span>
                            </div>
                            <div style="color: #6b7280; font-size: 0.95em;">
                                üë§ ${entry.utilisateur}<br>
                                ${entry.details ? `üìù ${entry.details}` : ''}
                            </div>
                        </div>
                    `;
                });
            } else {
                historyHTML += '<p style="text-align: center; color: #6b7280; padding: 20px;">Aucun historique disponible</p>';
            }
            
            historyHTML += '</div></div>';
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 700px;">
                    <div class="modal-header">
                        <h2>üìú Historique</h2>
                        <button class="close-btn" onclick="this.closest('.modal').remove()">√ó</button>
                    </div>
                    ${historyHTML}
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üîÑ RETOUR EN STOCK UNIVERSEL
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // Confirmer le retour en stock
        async function confirmReturn(event) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            const itemId = formData.get('itemId');
            const type = formData.get('type');
            const submitBtn = form.querySelector('button[type="submit"]');
            
            try {
                submitBtn.disabled = true;
                submitBtn.textContent = '‚è≥ Traitement...';
                
                const collections = {
                    'masque': 'masques',
                    'tuyau': 'tuyaux',
                    'batterie': 'batteries',
                    'moteur': 'moteurs'
                };
                
                const collection = collections[type];
                const item = data[collection].find(i => i.id === itemId);
                
                if (!item) {
                    throw new Error('√âquipement introuvable');
                }
                
                const updates = {
                    statut: 'stock',
                    dateRetour: formData.get('dateRetour'),
                    remarquesRetour: formData.get('remarques') || '',
                    retourPar: currentUser.email,
                    historique: firebase.firestore.FieldValue.arrayUnion({
                        action: 'Retour en stock',
                        date: new Date().toISOString(),
                        utilisateur: `${currentUserData.prenom} ${currentUserData.nom}`,
                        details: formData.get('remarques') || 'Retour en stock'
                    })
                };
                
                await db.collection(collection).doc(itemId).update(updates);
                
                console.log('‚úÖ Retour valid√©:', itemId);
                showNotification('‚úÖ √âquipement retourn√© en stock', 'success');
                
                form.reset();
                closeModal('return-stock');
                
            } catch (error) {
                console.error('‚ùå Erreur retour stock:', error);
                showNotification('‚ùå Erreur lors du retour', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = '‚úÖ Valider';
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üé® HELPER FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function getExpirationBadge(item) {
            const today = new Date();
            const expiration = new Date(item.dateExpiration);
            const daysRemaining = Math.floor((expiration - today) / (1000 * 60 * 60 * 24));
            
            if (daysRemaining < 0) {
                return '<span class="badge" style="background: var(--danger); color: white; padding: 5px 12px; border-radius: 20px;">‚ùå EXPIR√â</span>';
            } else if (daysRemaining <= 30) {
                return '<span class="badge" style="background: var(--danger); color: white; padding: 5px 12px; border-radius: 20px;">‚ö†Ô∏è URGENT</span>';
            } else if (daysRemaining <= 90) {
                return '<span class="badge" style="background: var(--warning); color: white; padding: 5px 12px; border-radius: 20px;">üî∂ ATTENTION</span>';
            } else {
                return '<span class="badge" style="background: var(--success); color: white; padding: 5px 12px; border-radius: 20px;">‚úÖ OPTIMAL</span>';
            }
        }

        function getStatusBadge(statut) {
            const badges = {
                'en-service': '<span class="badge" style="background: var(--success); color: white; padding: 5px 12px; border-radius: 20px;">‚úÖ En Service</span>',
                'stock': '<span class="badge" style="background: var(--info); color: white; padding: 5px 12px; border-radius: 20px;">üì¶ En Stock</span>',
                'maintenance': '<span class="badge" style="background: var(--warning); color: white; padding: 5px 12px; border-radius: 20px;">üîß Maintenance</span>',
                'hors-service': '<span class="badge" style="background: var(--danger); color: white; padding: 5px 12px; border-radius: 20px;">‚ùå Hors Service</span>'
            };
            return badges[statut] || statut;
        }
    </script>
    <script>
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üìä DISPLAY FUNCTIONS - MASQUES
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function displayMasques() {
            const container = document.getElementById('masques-list');
            const filterStatut = document.getElementById('filter-masque-statut').value;
            const filterExpiration = document.getElementById('filter-masque-expiration').value;
            const searchTerm = document.getElementById('search-masques').value.toLowerCase();
            
            let filtered = data.masques.filter(masque => {
                // Filter by status
                if (filterStatut && masque.statut !== filterStatut) return false;
                
                // Filter by expiration
                if (filterExpiration) {
                    const today = new Date();
                    const expiration = new Date(masque.dateExpiration);
                    const daysRemaining = Math.floor((expiration - today) / (1000 * 60 * 60 * 24));
                    
                    if (filterExpiration === 'expire' && daysRemaining >= 0) return false;
                    if (filterExpiration === 'urgent' && (daysRemaining < 0 || daysRemaining > 30)) return false;
                    if (filterExpiration === 'attention' && (daysRemaining < 30 || daysRemaining > 90)) return false;
                    if (filterExpiration === 'ok' && daysRemaining <= 90) return false;
                }
                
                // Search filter
                if (searchTerm) {
                    const searchFields = [
                        masque.reference,
                        masque.modele,
                        masque.taille,
                        masque.nomUtilisateur,
                        masque.prenomUtilisateur
                    ].join(' ').toLowerCase();
                    
                    if (!searchFields.includes(searchTerm)) return false;
                }
                
                return true;
            });
            
            // Sort by expiration date
            filtered.sort((a, b) => {
                const dateA = new Date(a.dateExpiration);
                const dateB = new Date(b.dateExpiration);
                return dateA - dateB;
            });
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: #6b7280;">
                        <div style="font-size: 64px; margin-bottom: 20px;">üîç</div>
                        <h3 style="margin-bottom: 10px;">Aucun masque trouv√©</h3>
                        <p>Essayez de modifier vos filtres de recherche</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filtered.map(masque => {
                const today = new Date();
                const expiration = new Date(masque.dateExpiration);
                const daysRemaining = Math.floor((expiration - today) / (1000 * 60 * 60 * 24));
                
                let expirationClass = 'optimal';
                let expirationIcon = '‚úÖ';
                let expirationText = `${daysRemaining} jours restants`;
                
                if (daysRemaining < 0) {
                    expirationClass = 'expired';
                    expirationIcon = '‚ùå';
                    expirationText = `EXPIR√â depuis ${Math.abs(daysRemaining)} jours`;
                } else if (daysRemaining <= 30) {
                    expirationClass = 'urgent';
                    expirationIcon = ‚ö†Ô∏è';
                    expirationText = `URGENT: ${daysRemaining} jours restants`;
                } else if (daysRemaining <= 90) {
                    expirationClass = 'attention';
                    expirationIcon = 'üî∂';
                    expirationText = `ATTENTION: ${daysRemaining} jours restants`;
                }
                
                return `
                    <div class="card expiration-${expirationClass}">
                        <div class="card-header">
                            <div>
                                <h3>üò∑ ${masque.reference}</h3>
                                <p style="color: #6b7280; margin: 5px 0 0 0;">${masque.modele} - Taille ${masque.taille}</p>
                            </div>
                            ${getStatusBadge(masque.statut)}
                        </div>
                        
                        <div class="card-body">
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <strong style="color: #6b7280; font-size: 0.9em;">üë§ Utilisateur</strong>
                                    <p style="margin: 5px 0 0 0;">${masque.prenomUtilisateur} ${masque.nomUtilisateur}</p>
                                </div>
                                <div>
                                    <strong style="color: #6b7280; font-size: 0.9em;">üìÖ Ouverture</strong>
                                    <p style="margin: 5px 0 0 0;">${formatDate(masque.dateOuverture)}</p>
                                </div>
                            </div>
                            
                            <div class="expiration-alert expiration-${expirationClass}">
                                <div style="font-size: 24px; margin-bottom: 5px;">${expirationIcon}</div>
                                <div>
                                    <strong>Expiration: ${formatDate(masque.dateExpiration)}</strong>
                                    <p style="margin: 5px 0 0 0; font-size: 0.9em;">${expirationText}</p>
                                </div>
                            </div>
                            
                            ${masque.remarques ? `
                                <div style="margin-top: 15px; padding: 10px; background: #f9fafb; border-radius: 8px;">
                                    <strong style="color: #6b7280; font-size: 0.9em;">üìù Remarques:</strong>
                                    <p style="margin: 5px 0 0 0;">${masque.remarques}</p>
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="card-actions">
                            <button onclick="viewMasqueHistory('${masque.id}')" class="btn-secondary" style="flex: 1;">
                                üìú Historique
                            </button>
                            ${masque.statut === 'en-service' ? `
                                <button onclick="returnMasque('${masque.id}')" class="btn-warning" style="flex: 1;">
                                    üîÑ Retour Stock
                                </button>
                            ` : ''}
                            ${currentUserData && currentUserData.role === 'admin' ? `
                                <button onclick="deleteMasque('${masque.id}')" class="btn-danger" style="flex: 1;">
                                    üóëÔ∏è Supprimer
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üìä DISPLAY FUNCTIONS - TUYAUX
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function displayTuyaux() {
            const container = document.getElementById('tuyaux-list');
            const filterStatut = document.getElementById('filter-tuyau-statut').value;
            const filterExpiration = document.getElementById('filter-tuyau-expiration').value;
            const searchTerm = document.getElementById('search-tuyaux').value.toLowerCase();
            
            let filtered = data.tuyaux.filter(tuyau => {
                // Filter by status
                if (filterStatut && tuyau.statut !== filterStatut) return false;
                
                // Filter by expiration
                if (filterExpiration) {
                    const today = new Date();
                    const expiration = new Date(tuyau.dateExpiration);
                    const daysRemaining = Math.floor((expiration - today) / (1000 * 60 * 60 * 24));
                    
                    if (filterExpiration === 'expire' && daysRemaining >= 0) return false;
                    if (filterExpiration === 'urgent' && (daysRemaining < 0 || daysRemaining > 30)) return false;
                    if (filterExpiration === 'attention' && (daysRemaining < 30 || daysRemaining > 90)) return false;
                    if (filterExpiration === 'ok' && daysRemaining <= 90) return false;
                }
                
                // Search filter
                if (searchTerm) {
                    const searchFields = [
                        tuyau.reference,
                        tuyau.type,
                        tuyau.longueur,
                        tuyau.diametre,
                        tuyau.nomUtilisateur,
                        tuyau.prenomUtilisateur
                    ].join(' ').toLowerCase();
                    
                    if (!searchFields.includes(searchTerm)) return false;
                }
                
                return true;
            });
            
            // Sort by expiration date
            filtered.sort((a, b) => {
                const dateA = new Date(a.dateExpiration);
                const dateB = new Date(b.dateExpiration);
                return dateA - dateB;
            });
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: #6b7280;">
                        <div style="font-size: 64px; margin-bottom: 20px;">üîç</div>
                        <h3 style="margin-bottom: 10px;">Aucun tuyau trouv√©</h3>
                        <p>Essayez de modifier vos filtres de recherche</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filtered.map(tuyau => {
                const today = new Date();
                const expiration = new Date(tuyau.dateExpiration);
                const daysRemaining = Math.floor((expiration - today) / (1000 * 60 * 60 * 24));
                
                let expirationClass = 'optimal';
                let expirationIcon = '‚úÖ';
                let expirationText = `${daysRemaining} jours restants`;
                
                if (daysRemaining < 0) {
                    expirationClass = 'expired';
                    expirationIcon = '‚ùå';
                    expirationText = `EXPIR√â depuis ${Math.abs(daysRemaining)} jours`;
                } else if (daysRemaining <= 30) {
                    expirationClass = 'urgent';
                    expirationIcon = '‚ö†Ô∏è';
                    expirationText = `URGENT: ${daysRemaining} jours restants`;
                } else if (daysRemaining <= 90) {
                    expirationClass = 'attention';
                    expirationIcon = 'üî∂';
                    expirationText = `ATTENTION: ${daysRemaining} jours restants`;
                }
                
                return `
                    <div class="card expiration-${expirationClass}">
                        <div class="card-header">
                            <div>
                                <h3>üîß ${tuyau.reference}</h3>
                                <p style="color: #6b7280; margin: 5px 0 0 0;">${tuyau.type} - ${tuyau.longueur}m - √ò${tuyau.diametre}mm</p>
                            </div>
                            ${getStatusBadge(tuyau.statut)}
                        </div>
                        
                        <div class="card-body">
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <strong style="color: #6b7280; font-size: 0.9em;">üë§ Utilisateur</strong>
                                    <p style="margin: 5px 0 0 0;">${tuyau.prenomUtilisateur} ${tuyau.nomUtilisateur}</p>
                                </div>
                                <div>
                                    <strong style="color: #6b7280; font-size: 0.9em;">üìÖ Ouverture</strong>
                                    <p style="margin: 5px 0 0 0;">${formatDate(tuyau.dateOuverture)}</p>
                                </div>
                            </div>
                            
                            <div class="expiration-alert expiration-${expirationClass}">
                                <div style="font-size: 24px; margin-bottom: 5px;">${expirationIcon}</div>
                                <div>
                                    <strong>Expiration: ${formatDate(tuyau.dateExpiration)}</strong>
                                    <p style="margin: 5px 0 0 0; font-size: 0.9em;">${expirationText}</p>
                                </div>
                            </div>
                            
                            ${tuyau.remarques ? `
                                <div style="margin-top: 15px; padding: 10px; background: #f9fafb; border-radius: 8px;">
                                    <strong style="color: #6b7280; font-size: 0.9em;">üìù Remarques:</strong>
                                    <p style="margin: 5px 0 0 0;">${tuyau.remarques}</p>
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="card-actions">
                            <button onclick="viewTuyauHistory('${tuyau.id}')" class="btn-secondary" style="flex: 1;">
                                üìú Historique
                            </button>
                            ${tuyau.statut === 'en-service' ? `
                                <button onclick="returnTuyau('${tuyau.id}')" class="btn-warning" style="flex: 1;">
                                    üîÑ Retour Stock
                                </button>
                            ` : ''}
                            ${currentUserData && currentUserData.role === 'admin' ? `
                                <button onclick="deleteTuyau('${tuyau.id}')" class="btn-danger" style="flex: 1;">
                                    üóëÔ∏è Supprimer
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üìä DISPLAY FUNCTIONS - BATTERIES
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function displayBatteries() {
            const container = document.getElementById('batteries-list');
            const filterStatut = document.getElementById('filter-batterie-statut').value;
            const filterExpiration = document.getElementById('filter-batterie-expiration').value;
            const searchTerm = document.getElementById('search-batteries').value.toLowerCase();
            
            let filtered = data.batteries.filter(batterie => {
                // Filter by status
                if (filterStatut && batterie.statut !== filterStatut) return false;
                
                // Filter by expiration
                if (filterExpiration) {
                    const today = new Date();
                    const expiration = new Date(batterie.dateExpiration);
                    const daysRemaining = Math.floor((expiration - today) / (1000 * 60 * 60 * 24));
                    
                    if (filterExpiration === 'expire' && daysRemaining >= 0) return false;
                    if (filterExpiration === 'urgent' && (daysRemaining < 0 || daysRemaining > 30)) return false;
                    if (filterExpiration === 'attention' && (daysRemaining < 30 || daysRemaining > 90)) return false;
                    if (filterExpiration === 'ok' && daysRemaining <= 90) return false;
                }
                
                // Search filter
                if (searchTerm) {
                    const searchFields = [
                        batterie.reference,
                        batterie.modele,
                        batterie.capacite,
                        batterie.tension,
                        batterie.nomUtilisateur,
                        batterie.prenomUtilisateur
                    ].join(' ').toLowerCase();
                    
                    if (!searchFields.includes(searchTerm)) return false;
                }
                
                return true;
            });
            
            // Sort by expiration date
            filtered.sort((a, b) => {
                const dateA = new Date(a.dateExpiration);
                const dateB = new Date(b.dateExpiration);
                return dateA - dateB;
            });
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: #6b7280;">
                        <div style="font-size: 64px; margin-bottom: 20px;">üîç</div>
                        <h3 style="margin-bottom: 10px;">Aucune batterie trouv√©e</h3>
                        <p>Essayez de modifier vos filtres de recherche</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filtered.map(batterie => {
                const today = new Date();
                const expiration = new Date(batterie.dateExpiration);
                const daysRemaining = Math.floor((expiration - today) / (1000 * 60 * 60 * 24));
                
                let expirationClass = 'optimal';
                let expirationIcon = '‚úÖ';
                let expirationText = `${daysRemaining} jours restants`;
                
                if (daysRemaining < 0) {
                    expirationClass = 'expired';
                    expirationIcon = '‚ùå';
                    expirationText = `EXPIR√â depuis ${Math.abs(daysRemaining)} jours`;
                } else if (daysRemaining <= 30) {
                    expirationClass = 'urgent';
                    expirationIcon = '‚ö†Ô∏è';
                    expirationText = `URGENT: ${daysRemaining} jours restants`;
                } else if (daysRemaining <= 90) {
                    expirationClass = 'attention';
                    expirationIcon = 'üî∂';
                    expirationText = `ATTENTION: ${daysRemaining} jours restants`;
                }
                
                return `
                    <div class="card expiration-${expirationClass}">
                        <div class="card-header">
                            <div>
                                <h3>üîã ${batterie.reference}</h3>
                                <p style="color: #6b7280; margin: 5px 0 0 0;">${batterie.modele} - ${batterie.capacite}mAh - ${batterie.tension}V</p>
                            </div>
                            ${getStatusBadge(batterie.statut)}
                        </div>
                        
                        <div class="card-body">
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <strong style="color: #6b7280; font-size: 0.9em;">üë§ Utilisateur</strong>
                                    <p style="margin: 5px 0 0 0;">${batterie.prenomUtilisateur} ${batterie.nomUtilisateur}</p>
                                </div>
                                <div>
                                    <strong style="color: #6b7280; font-size: 0.9em;">üìÖ Ouverture</strong>
                                    <p style="margin: 5px 0 0 0;">${formatDate(batterie.dateOuverture)}</p>
                                </div>
                            </div>
                            
                            <div class="expiration-alert expiration-${expirationClass}">
                                <div style="font-size: 24px; margin-bottom: 5px;">${expirationIcon}</div>
                                <div>
                                    <strong>Expiration: ${formatDate(batterie.dateExpiration)}</strong>
                                    <p style="margin: 5px 0 0 0; font-size: 0.9em;">${expirationText}</p>
                                </div>
                            </div>
                            
                            ${batterie.remarques ? `
                                <div style="margin-top: 15px; padding: 10px; background: #f9fafb; border-radius: 8px;">
                                    <strong style="color: #6b7280; font-size: 0.9em;">üìù Remarques:</strong>
                                    <p style="margin: 5px 0 0 0;">${batterie.remarques}</p>
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="card-actions">
                            <button onclick="viewBatterieHistory('${batterie.id}')" class="btn-secondary" style="flex: 1;">
                                üìú Historique
                            </button>
                            ${batterie.statut === 'en-service' ? `
                                <button onclick="returnBatterie('${batterie.id}')" class="btn-warning" style="flex: 1;">
                                    üîÑ Retour Stock
                                </button>
                            ` : ''}
                            ${currentUserData && currentUserData.role === 'admin' ? `
                                <button onclick="deleteBatterie('${batterie.id}')" class="btn-danger" style="flex: 1;">
                                    üóëÔ∏è Supprimer
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üìä DISPLAY FUNCTIONS - MOTEURS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function displayMoteurs() {
            const container = document.getElementById('moteurs-list');
            const filterStatut = document.getElementById('filter-moteur-statut').value;
            const filterExpiration = document.getElementById('filter-moteur-expiration').value;
            const searchTerm = document.getElementById('search-moteurs').value.toLowerCase();
            
            let filtered = data.moteurs.filter(moteur => {
                // Filter by status
                if (filterStatut && moteur.statut !== filterStatut) return false;
                
                // Filter by expiration
                if (filterExpiration) {
                    const today = new Date();
                    const expiration = new Date(moteur.dateExpiration);
                    const daysRemaining = Math.floor((expiration - today) / (1000 * 60 * 60 * 24));
                    
                    if (filterExpiration === 'expire' && daysRemaining >= 0) return false;
                    if (filterExpiration === 'urgent' && (daysRemaining < 0 || daysRemaining > 30)) return false;
                    if (filterExpiration === 'attention' && (daysRemaining < 30 || daysRemaining > 90)) return false;
                    if (filterExpiration === 'ok' && daysRemaining <= 90) return false;
                }
                
                // Search filter
                if (searchTerm) {
                    const searchFields = [
                        moteur.reference,
                        moteur.modele,
                        moteur.puissance,
                        moteur.numeroSerie,
                        moteur.nomUtilisateur,
                        moteur.prenomUtilisateur
                    ].join(' ').toLowerCase();
                    
                    if (!searchFields.includes(searchTerm)) return false;
                }
                
                return true;
            });
            
            // Sort by expiration date
            filtered.sort((a, b) => {
                const dateA = new Date(a.dateExpiration);
                const dateB = new Date(b.dateExpiration);
                return dateA - dateB;
            });
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: #6b7280;">
                        <div style="font-size: 64px; margin-bottom: 20px;">üîç</div>
                        <h3 style="margin-bottom: 10px;">Aucun moteur trouv√©</h3>
                        <p>Essayez de modifier vos filtres de recherche</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filtered.map(moteur => {
                const today = new Date();
                const expiration = new Date(moteur.dateExpiration);
                const daysRemaining = Math.floor((expiration - today) / (1000 * 60 * 60 * 24));
                
                let expirationClass = 'optimal';
                let expirationIcon = '‚úÖ';
                let expirationText = `${daysRemaining} jours restants`;
                
                if (daysRemaining < 0) {
                    expirationClass = 'expired';
                    expirationIcon = '‚ùå';
                    expirationText = `EXPIR√â depuis ${Math.abs(daysRemaining)} jours`;
                } else if (daysRemaining <= 30) {
                    expirationClass = 'urgent';
                    expirationIcon = '‚ö†Ô∏è';
                    expirationText = `URGENT: ${daysRemaining} jours restants`;
                } else if (daysRemaining <= 90) {
                    expirationClass = 'attention';
                    expirationIcon = 'üî∂';
                    expirationText = `ATTENTION: ${daysRemaining} jours restants`;
                }
                
                return `
                    <div class="card expiration-${expirationClass}">
                        <div class="card-header">
                            <div>
                                <h3>‚öôÔ∏è ${moteur.reference}</h3>
                                <p style="color: #6b7280; margin: 5px 0 0 0;">${moteur.modele} - ${moteur.puissance}W - N¬∞${moteur.numeroSerie}</p>
                            </div>
                            ${getStatusBadge(moteur.statut)}
                        </div>
                        
                        <div class="card-body">
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <strong style="color: #6b7280; font-size: 0.9em;">üë§ Utilisateur</strong>
                                    <p style="margin: 5px 0 0 0;">${moteur.prenomUtilisateur} ${moteur.nomUtilisateur}</p>
                                </div>
                                <div>
                                    <strong style="color: #6b7280; font-size: 0.9em;">üìÖ Ouverture</strong>
                                    <p style="margin: 5px 0 0 0;">${formatDate(moteur.dateOuverture)}</p>
                                </div>
                            </div>
                            
                            <div class="expiration-alert expiration-${expirationClass}">
                                <div style="font-size: 24px; margin-bottom: 5px;">${expirationIcon}</div>
                                <div>
                                    <strong>Expiration: ${formatDate(moteur.dateExpiration)}</strong>
                                    <p style="margin: 5px 0 0 0; font-size: 0.9em;">${expirationText}</p>
                                </div>
                            </div>
                            
                            ${moteur.remarques ? `
                                <div style="margin-top: 15px; padding: 10px; background: #f9fafb; border-radius: 8px;">
                                    <strong style="color: #6b7280; font-size: 0.9em;">üìù Remarques:</strong>
                                    <p style="margin: 5px 0 0 0;">${moteur.remarques}</p>
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="card-actions">
                            <button onclick="viewMoteurHistory('${moteur.id}')" class="btn-secondary" style="flex: 1;">
                                üìú Historique
                            </button>
                            ${moteur.statut === 'en-service' ? `
                                <button onclick="returnMoteur('${moteur.id}')" class="btn-warning" style="flex: 1;">
                                    üîÑ Retour Stock
                                </button>
                            ` : ''}
                            ${currentUserData && currentUserData.role === 'admin' ? `
                                <button onclick="deleteMoteur('${moteur.id}')" class="btn-danger" style="flex: 1;">
                                    üóëÔ∏è Supprimer
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }
    </script>
    <script>
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üìä STATISTIQUES - CALCULS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function calculateStats() {
            const stats = {
                masques: {
                    total: data.masques.length,
                    enService: data.masques.filter(m => m.statut === 'en-service').length,
                    stock: data.masques.filter(m => m.statut === 'stock').length,
                    expired: 0,
                    urgent: 0,
                    attention: 0,
                    optimal: 0
                },
                tuyaux: {
                    total: data.tuyaux.length,
                    enService: data.tuyaux.filter(t => t.statut === 'en-service').length,
                    stock: data.tuyaux.filter(t => t.statut === 'stock').length,
                    expired: 0,
                    urgent: 0,
                    attention: 0,
                    optimal: 0
                },
                batteries: {
                    total: data.batteries.length,
                    enService: data.batteries.filter(b => b.statut === 'en-service').length,
                    stock: data.batteries.filter(b => b.statut === 'stock').length,
                    expired: 0,
                    urgent: 0,
                    attention: 0,
                    optimal: 0
                },
                moteurs: {
                    total: data.moteurs.length,
                    enService: data.moteurs.filter(m => m.statut === 'en-service').length,
                    stock: data.moteurs.filter(m => m.statut === 'stock').length,
                    expired: 0,
                    urgent: 0,
                    attention: 0,
                    optimal: 0
                }
            };
            
            const today = new Date();
            
            // Calculate expiration stats for masques
            data.masques.forEach(masque => {
                const expiration = new Date(masque.dateExpiration);
                const daysRemaining = Math.floor((expiration - today) / (1000 * 60 * 60 * 24));
                
                if (daysRemaining < 0) stats.masques.expired++;
                else if (daysRemaining <= 30) stats.masques.urgent++;
                else if (daysRemaining <= 90) stats.masques.attention++;
                else stats.masques.optimal++;
            });
            
            // Calculate expiration stats for tuyaux
            data.tuyaux.forEach(tuyau => {
                const expiration = new Date(tuyau.dateExpiration);
                const daysRemaining = Math.floor((expiration - today) / (1000 * 60 * 60 * 24));
                
                if (daysRemaining < 0) stats.tuyaux.expired++;
                else if (daysRemaining <= 30) stats.tuyaux.urgent++;
                else if (daysRemaining <= 90) stats.tuyaux.attention++;
                else stats.tuyaux.optimal++;
            });
            
            // Calculate expiration stats for batteries
            data.batteries.forEach(batterie => {
                const expiration = new Date(batterie.dateExpiration);
                const daysRemaining = Math.floor((expiration - today) / (1000 * 60 * 60 * 24));
                
                if (daysRemaining < 0) stats.batteries.expired++;
                else if (daysRemaining <= 30) stats.batteries.urgent++;
                else if (daysRemaining <= 90) stats.batteries.attention++;
                else stats.batteries.optimal++;
            });
            
            // Calculate expiration stats for moteurs
            data.moteurs.forEach(moteur => {
                const expiration = new Date(moteur.dateExpiration);
                const daysRemaining = Math.floor((expiration - today) / (1000 * 60 * 60 * 24));
                
                if (daysRemaining < 0) stats.moteurs.expired++;
                else if (daysRemaining <= 30) stats.moteurs.urgent++;
                else if (daysRemaining <= 90) stats.moteurs.attention++;
                else stats.moteurs.optimal++;
            });
            
            return stats;
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üìä DISPLAY STATISTIQUES
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function displayStatistics() {
            const stats = calculateStats();
            
            // Update global stats cards
            document.getElementById('total-masques').textContent = stats.masques.total;
            document.getElementById('total-tuyaux').textContent = stats.tuyaux.total;
            document.getElementById('total-batteries').textContent = stats.batteries.total;
            document.getElementById('total-moteurs').textContent = stats.moteurs.total;
            
            // Calculate total alerts
            const totalAlerts = 
                stats.masques.expired + stats.masques.urgent +
                stats.tuyaux.expired + stats.tuyaux.urgent +
                stats.batteries.expired + stats.batteries.urgent +
                stats.moteurs.expired + stats.moteurs.urgent;
            
            document.getElementById('total-alerts').textContent = totalAlerts;
            
            // Display detailed stats for each category
            displayCategoryStats('masques', stats.masques);
            displayCategoryStats('tuyaux', stats.tuyaux);
            displayCategoryStats('batteries', stats.batteries);
            displayCategoryStats('moteurs', stats.moteurs);
            
            // Update charts
            updateCharts(stats);
        }

        function displayCategoryStats(category, stats) {
            const container = document.getElementById(`stats-${category}`);
            if (!container) return;
            
            const categoryNames = {
                masques: 'üò∑ Masques',
                tuyaux: 'üîß Tuyaux',
                batteries: 'üîã Batteries',
                moteurs: ‚öôÔ∏è Moteurs'
            };
            
            container.innerHTML = `
                <div class="stats-card">
                    <h3 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        ${categoryNames[category]}
                        <span style="background: var(--primary); color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.9em;">
                            ${stats.total} Total
                        </span>
                    </h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
                        <div style="background: #f0f9ff; padding: 15px; border-radius: 12px; border-left: 4px solid var(--info);">
                            <div style="font-size: 0.9em; color: #6b7280; margin-bottom: 5px;">‚úÖ En Service</div>
                            <div style="font-size: 1.8em; font-weight: bold; color: var(--info);">${stats.enService}</div>
                        </div>
                        
                        <div style="background: #f0fdf4; padding: 15px; border-radius: 12px; border-left: 4px solid var(--success);">
                            <div style="font-size: 0.9em; color: #6b7280; margin-bottom: 5px;">üì¶ En Stock</div>
                            <div style="font-size: 1.8em; font-weight: bold; color: var(--success);">${stats.stock}</div>
                        </div>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 12px; color: white; margin-bottom: 15px;">
                        <h4 style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            ‚è∞ √âtat des Expirations
                        </h4>
                        
                        <div style="display: grid; gap: 12px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px;">
                                <span style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 1.2em;">‚ùå</span>
                                    <span>EXPIR√âS</span>
                                </span>
                                <span style="font-size: 1.5em; font-weight: bold; background: rgba(255,255,255,0.2); padding: 5px 15px; border-radius: 20px;">
                                    ${stats.expired}
                                </span>
                            </div>
                            
                            <div style="display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px;">
                                <span style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 1.2em;">‚ö†Ô∏è</span>
                                    <span>URGENT (‚â§30j)</span>
                                </span>
                                <span style="font-size: 1.5em; font-weight: bold; background: rgba(255,255,255,0.2); padding: 5px 15px; border-radius: 20px;">
                                    ${stats.urgent}
                                </span>
                            </div>
                            
                            <div style="display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px;">
                                <span style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 1.2em;">üî∂</span>
                                    <span>ATTENTION (‚â§90j)</span>
                                </span>
                                <span style="font-size: 1.5em; font-weight: bold; background: rgba(255,255,255,0.2); padding: 5px 15px; border-radius: 20px;">
                                    ${stats.attention}
                                </span>
                            </div>
                            
                            <div style="display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px;">
                                <span style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 1.2em;">‚úÖ</span>
                                    <span>OPTIMAL (>90j)</span>
                                </span>
                                <span style="font-size: 1.5em; font-weight: bold; background: rgba(255,255,255,0.2); padding: 5px 15px; border-radius: 20px;">
                                    ${stats.optimal}
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    ${stats.expired > 0 || stats.urgent > 0 ? `
                        <div style="background: #fee2e2; padding: 15px; border-radius: 12px; border-left: 4px solid var(--danger);">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                <span style="font-size: 1.5em;">üö®</span>
                                <strong style="color: var(--danger);">ACTION REQUISE</strong>
                            </div>
                            <p style="margin: 0; color: #7f1d1d; font-size: 0.9em;">
                                ${stats.expired + stats.urgent} √©quipement(s) n√©cessitent une attention imm√©diate
                            </p>
                        </div>
                    ` : `
                        <div style="background: #d1fae5; padding: 15px; border-radius: 12px; border-left: 4px solid var(--success);">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 1.5em;">‚úÖ</span>
                                <strong style="color: var(--success);">Tout est en ordre</strong>
                            </div>
                        </div>
                    `}
                </div>
            `;
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üìà CHARTS - Chart.js Integration
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        let statusChart = null;
        let expirationChart = null;

        function updateCharts(stats) {
            // Destroy existing charts
            if (statusChart) statusChart.destroy();
            if (expirationChart) expirationChart.destroy();
            
            // Status Distribution Chart
            const statusCtx = document.getElementById('statusChart');
            if (statusCtx) {
                statusChart = new Chart(statusCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['üò∑ Masques', 'üîß Tuyaux', 'üîã Batteries', '‚öôÔ∏è Moteurs'],
                        datasets: [{
                            label: 'En Service',
                            data: [
                                stats.masques.enService,
                                stats.tuyaux.enService,
                                stats.batteries.enService,
                                stats.moteurs.enService
                            ],
                            backgroundColor: [
                                'rgba(59, 130, 246, 0.8)',
                                'rgba(16, 185, 129, 0.8)',
                                'rgba(251, 191, 36, 0.8)',
                                'rgba(239, 68, 68, 0.8)'
                            ],
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 15,
                                    font: {
                                        size: 13
                                    }
                                }
                            },
                            title: {
                                display: true,
                                text: 'üìä R√©partition des √âquipements en Service',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                },
                                padding: 20
                            }
                        }
                    }
                });
            }
            
            // Expiration Status Chart
            const expirationCtx = document.getElementById('expirationChart');
            if (expirationCtx) {
                expirationChart = new Chart(expirationCtx, {
                    type: 'bar',
                    data: {
                        labels: ['üò∑ Masques', 'üîß Tuyaux', 'üîã Batteries', '‚öôÔ∏è Moteurs'],
                        datasets: [
                            {
                                label: '‚ùå Expir√©s',
                                data: [stats.masques.expired, stats.tuyaux.expired, stats.batteries.expired, stats.moteurs.expired],
                                backgroundColor: 'rgba(239, 68, 68, 0.8)',
                                borderRadius: 8
                            },
                            {
                                label: '‚ö†Ô∏è Urgent (‚â§30j)',
                                data: [stats.masques.urgent, stats.tuyaux.urgent, stats.batteries.urgent, stats.moteurs.urgent],
                                backgroundColor: 'rgba(251, 191, 36, 0.8)',
                                borderRadius: 8
                            },
                            {
                                label: 'üî∂ Attention (‚â§90j)',
                                data: [stats.masques.attention, stats.tuyaux.attention, stats.batteries.attention, stats.moteurs.attention],
                                backgroundColor: 'rgba(251, 146, 60, 0.8)',
                                borderRadius: 8
                            },
                            {
                                label: '‚úÖ Optimal (>90j)',
                                data: [stats.masques.optimal, stats.tuyaux.optimal, stats.batteries.optimal, stats.moteurs.optimal],
                                backgroundColor: 'rgba(16, 185, 129, 0.8)',
                                borderRadius: 8
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                stacked: true,
                                grid: {
                                    display: false
                                }
                            },
                            y: {
                                stacked: true,
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 15,
                                    font: {
                                        size: 13
                                    }
                                }
                            },
                            title: {
                                display: true,
                                text: '‚è∞ √âtat des Expirations par Cat√©gorie',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                },
                                padding: 20
                            }
                        }
                    }
                });
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üìä DASHBOARD ALERTS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function displayDashboardAlerts() {
            const container = document.getElementById('dashboard-alerts');
            if (!container) return;
            
            const today = new Date();
            let alerts = [];
            
            // Collect all items that need attention
            [...data.masques, ...data.tuyaux, ...data.batteries, ...data.moteurs].forEach(item => {
                const expiration = new Date(item.dateExpiration);
                const daysRemaining = Math.floor((expiration - today) / (1000 * 60 * 60 * 24));
                
                let category = '';
                let icon = '';
                
                if (item.hasOwnProperty('taille')) {
                    category = 'Masque';
                    icon = 'üò∑';
                } else if (item.hasOwnProperty('longueur')) {
                    category = 'Tuyau';
                    icon = 'üîß';
                } else if (item.hasOwnProperty('capacite')) {
                    category = 'Batterie';
                    icon = 'üîã';
                } else {
                    category = 'Moteur';
                    icon = '‚öôÔ∏è';
                }
                
                if (daysRemaining < 0) {
                    alerts.push({
                        severity: 'critical',
                        icon: '‚ùå',
                        category,
                        categoryIcon: icon,
                        reference: item.reference,
                        message: `EXPIR√â depuis ${Math.abs(daysRemaining)} jours`,
                        daysRemaining,
                        item
                    });
                } else if (daysRemaining <= 30) {
                    alerts.push({
                        severity: 'urgent',
                        icon: '‚ö†Ô∏è',
                        category,
                        categoryIcon: icon,
                        reference: item.reference,
                        message: `Expire dans ${daysRemaining} jours`,
                        daysRemaining,
                        item
                    });
                }
            });
            
            // Sort by days remaining (most critical first)
            alerts.sort((a, b) => a.daysRemaining - b.daysRemaining);
            
            if (alerts.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; background: #d1fae5; border-radius: 12px;">
                        <div style="font-size: 48px; margin-bottom: 15px;">‚úÖ</div>
                        <h3 style="color: var(--success); margin-bottom: 10px;">Aucune alerte</h3>
                        <p style="color: #065f46;">Tous les √©quipements sont en ordre</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <div style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                        üö® <span>${alerts.length} Alerte(s) Active(s)</span>
                    </h3>
                    <p style="margin: 0; opacity: 0.9;">Action imm√©diate requise pour les √©quipements suivants</p>
                </div>
                
                <div style="display: grid; gap: 12px;">
                    ${alerts.map(alert => `
                        <div style="background: ${alert.severity === 'critical' ? '#fee2e2' : '#fef3c7'}; padding: 15px; border-radius: 12px; border-left: 4px solid ${alert.severity === 'critical' ? 'var(--danger)' : 'var(--warning)'};">
                            <div style="display: flex; align-items: center; justify-content: space-between; gap: 15px;">
                                <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                                    <span style="font-size: 1.8em;">${alert.icon}</span>
                                    <div>
                                        <div style="font-weight: bold; color: #1f2937; margin-bottom: 3px;">
                                            ${alert.categoryIcon} ${alert.category} - ${alert.reference}
                                        </div>
                                        <div style="color: #6b7280; font-size: 0.9em;">
                                            ${alert.message}
                                        </div>
                                    </div>
                                </div>
                                <span style="background: ${alert.severity === 'critical' ? 'var(--danger)' : 'var(--warning)'}; color: white; padding: 8px 16px; border-radius: 20px; font-weight: bold; white-space: nowrap;">
                                    ${alert.daysRemaining < 0 ? 'EXPIR√â' : `${alert.daysRemaining}j`}
                                </span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }
    </script>
    <script>
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üõ†Ô∏è UTILITY FUNCTIONS - HELPERS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // Format date for display
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('fr-FR', options);
        }

        // Format datetime for display
        function formatDateTime(timestamp) {
            if (!timestamp) return 'N/A';
            const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
            return date.toLocaleString('fr-FR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Calculate days until expiration
        function getDaysUntilExpiration(expirationDate) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const expiration = new Date(expirationDate);
            expiration.setHours(0, 0, 0, 0);
            const diffTime = expiration - today;
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            
            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 12px;">
                    <span style="font-size: 1.5em;">${icons[type] || icons.info}</span>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Trigger animation
            setTimeout(() => notification.classList.add('show'), 10);
            
            // Remove after 4 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        // Confirm dialog
        function confirmAction(message) {
            return new Promise((resolve) => {
                const overlay = document.createElement('div');
                overlay.className = 'modal-overlay';
                overlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 10000;
                    animation: fadeIn 0.2s ease;
                `;
                
                const dialog = document.createElement('div');
                dialog.style.cssText = `
                    background: white;
                    padding: 30px;
                    border-radius: 12px;
                    max-width: 400px;
                    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
                    animation: slideUp 0.3s ease;
                `;
                
                dialog.innerHTML = `
                    <div style="text-align: center; margin-bottom: 25px;">
                        <div style="font-size: 48px; margin-bottom: 15px;">‚ö†Ô∏è</div>
                        <h3 style="margin-bottom: 10px; color: #1f2937;">Confirmation requise</h3>
                        <p style="color: #6b7280; margin: 0;">${message}</p>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <button id="confirm-cancel" class="btn-secondary" style="width: 100%;">
                            ‚ùå Annuler
                        </button>
                        <button id="confirm-ok" class="btn-danger" style="width: 100%;">
                            ‚úÖ Confirmer
                        </button>
                    </div>
                `;
                
                overlay.appendChild(dialog);
                document.body.appendChild(overlay);
                
                document.getElementById('confirm-ok').onclick = () => {
                    overlay.remove();
                    resolve(true);
                };
                
                document.getElementById('confirm-cancel').onclick = () => {
                    overlay.remove();
                    resolve(false);
                };
                
                overlay.onclick = (e) => {
                    if (e.target === overlay) {
                        overlay.remove();
                        resolve(false);
                    }
                };
            });
        }

        // Show loading overlay
        function showLoading(message = 'Chargement...') {
            const overlay = document.createElement('div');
            overlay.id = 'loading-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10001;
                animation: fadeIn 0.2s ease;
            `;
            
            overlay.innerHTML = `
                <div style="background: white; padding: 30px 40px; border-radius: 12px; text-align: center;">
                    <div class="loader" style="margin-bottom: 20px;"></div>
                    <p style="margin: 0; color: #1f2937; font-weight: 500;">${message}</p>
                </div>
            `;
            
            document.body.appendChild(overlay);
        }

        // Hide loading overlay
        function hideLoading() {
            const overlay = document.getElementById('loading-overlay');
            if (overlay) {
                overlay.remove();
            }
        }

        // Export data to CSV
        function exportToCSV(data, filename, headers) {
            const csvContent = [
                headers.join(','),
                ...data.map(row => headers.map(header => {
                    const value = row[header] || '';
                    return `"${String(value).replace(/"/g, '""')}"`;
                }).join(','))
            ].join('\n');
            
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('‚úÖ Export CSV r√©ussi !', 'success');
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üì§ EXPORT FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function exportMasques() {
            const headers = ['reference', 'modele', 'taille', 'nomUtilisateur', 'prenomUtilisateur', 'dateOuverture', 'dateExpiration', 'statut', 'remarques'];
            exportToCSV(data.masques, 'masques_export.csv', headers);
        }

        function exportTuyaux() {
            const headers = ['reference', 'modele', 'longueur', 'nomUtilisateur', 'prenomUtilisateur', 'dateOuverture', 'dateExpiration', 'statut', 'remarques'];
            exportToCSV(data.tuyaux, 'tuyaux_export.csv', headers);
        }

        function exportBatteries() {
            const headers = ['reference', 'modele', 'capacite', 'nomUtilisateur', 'prenomUtilisateur', 'dateOuverture', 'dateExpiration', 'statut', 'remarques'];
            exportToCSV(data.batteries, 'batteries_export.csv', headers);
        }

        function exportMoteurs() {
            const headers = ['reference', 'modele', 'puissance', 'nomUtilisateur', 'prenomUtilisateur', 'dateOuverture', 'dateExpiration', 'statut', 'remarques'];
            exportToCSV(data.moteurs, 'moteurs_export.csv', headers);
        }

        function exportAllData() {
            showLoading('Pr√©paration de l\'export complet...');
            
            setTimeout(() => {
                exportMasques();
                setTimeout(() => exportTuyaux(), 300);
                setTimeout(() => exportBatteries(), 600);
                setTimeout(() => exportMoteurs(), 900);
                setTimeout(() => {
                    hideLoading();
                    showNotification('‚úÖ Export complet termin√© !', 'success');
                }, 1200);
            }, 500);
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üîç SEARCH & FILTER HELPERS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function resetFilters(category) {
            // Reset select filters
            document.getElementById(`filter-${category}-statut`).value = '';
            document.getElementById(`filter-${category}-expiration`).value = '';
            
            // Reset search
            document.getElementById(`search-${category}`).value = '';
            
            // Re-display data
            switch(category) {
                case 'masque':
                    displayMasques();
                    break;
                case 'tuyau':
                    displayTuyaux();
                    break;
                case 'batterie':
                    displayBatteries();
                    break;
                case 'moteur':
                    displayMoteurs();
                    break;
            }
            
            showNotification('üîÑ Filtres r√©initialis√©s', 'info');
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üì± RESPONSIVE HELPERS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function isMobile() {
            return window.innerWidth <= 768;
        }

        function adjustForMobile() {
            if (isMobile()) {
                // Adjust cards layout
                document.querySelectorAll('.cards-grid').forEach(grid => {
                    grid.style.gridTemplateColumns = '1fr';
                });
                
                // Adjust stats layout
                document.querySelectorAll('.stats-grid').forEach(grid => {
                    grid.style.gridTemplateColumns = '1fr';
                });
            }
        }

        // Listen for window resize
        window.addEventListener('resize', adjustForMobile);

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üìä PRINT FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function printReport() {
            const stats = calculateStats();
            const printWindow = window.open('', '_blank');
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Rapport EPI - ${formatDate(new Date())}</title>
                    <style>
                        body {
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                            max-width: 1200px;
                            margin: 0 auto;
                            padding: 40px;
                            color: #1f2937;
                        }
                        h1 {
                            color: #1e40af;
                            border-bottom: 3px solid #3b82f6;
                            padding-bottom: 15px;
                            margin-bottom: 30px;
                        }
                        h2 {
                            color: #1e40af;
                            margin-top: 40px;
                            margin-bottom: 20px;
                        }
                        .stats-grid {
                            display: grid;
                            grid-template-columns: repeat(4, 1fr);
                            gap: 20px;
                            margin: 30px 0;
                        }
                        .stat-card {
                            border: 2px solid #e5e7eb;
                            border-radius: 8px;
                            padding: 20px;
                            text-align: center;
                        }
                        .stat-value {
                            font-size: 36px;
                            font-weight: bold;
                            color: #1e40af;
                            margin: 10px 0;
                        }
                        .stat-label {
                            color: #6b7280;
                            font-size: 14px;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin: 20px 0;
                        }
                        th {
                            background: #f3f4f6;
                            padding: 12px;
                            text-align: left;
                            border-bottom: 2px solid #d1d5db;
                        }
                        td {
                            padding: 10px 12px;
                            border-bottom: 1px solid #e5e7eb;
                        }
                        .alert-critical {
                            background: #fee2e2;
                            color: #991b1b;
                            padding: 15px;
                            border-radius: 8px;
                            margin: 20px 0;
                            border-left: 4px solid #dc2626;
                        }
                        .alert-warning {
                            background: #fef3c7;
                            color: #92400e;
                            padding: 15px;
                            border-radius: 8px;
                            margin: 20px 0;
                            border-left: 4px solid #f59e0b;
                        }
                        @media print {
                            body { padding: 20px; }
                            .page-break { page-break-after: always; }
                        }
                    </style>
                </head>
                <body>
                    <h1>üìä Rapport de Gestion des EPI</h1>
                    <p><strong>Date du rapport:</strong> ${formatDate(new Date())}</p>
                    <p><strong>G√©n√©r√© par:</strong> ${currentUser.email}</p>
                    
                    <h2>üìà Vue d'ensemble</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">üò∑ MASQUES</div>
                            <div class="stat-value">${stats.masques.total}</div>
                            <div class="stat-label">En service: ${stats.masques.enService}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">üîß TUYAUX</div>
                            <div class="stat-value">${stats.tuyaux.total}</div>
                            <div class="stat-label">En service: ${stats.tuyaux.enService}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">üîã BATTERIES</div>
                            <div class="stat-value">${stats.batteries.total}</div>
                            <div class="stat-label">En service: ${stats.batteries.enService}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">‚öôÔ∏è MOTEURS</div>
                            <div class="stat-value">${stats.moteurs.total}</div>
                            <div class="stat-label">En service: ${stats.moteurs.enService}</div>
                        </div>
                    </div>
                    
                    ${(stats.masques.expired + stats.tuyaux.expired + stats.batteries.expired + stats.moteurs.expired) > 0 ? `
                        <div class="alert-critical">
                            <strong>üö® ALERTE CRITIQUE:</strong> ${stats.masques.expired + stats.tuyaux.expired + stats.batteries.expired + stats.moteurs.expired} √©quipement(s) expir√©(s)
                        </div>
                    ` : ''}
                    
                    ${(stats.masques.urgent + stats.tuyaux.urgent + stats.batteries.urgent + stats.moteurs.urgent) > 0 ? `
                        <div class="alert-warning">
                            <strong>‚ö†Ô∏è ATTENTION:</strong> ${stats.masques.urgent + stats.tuyaux.urgent + stats.batteries.urgent + stats.moteurs.urgent} √©quipement(s) expire(nt) dans moins de 30 jours
                        </div>
                    ` : ''}
                    
                    <div class="page-break"></div>
                    
                    <h2>üò∑ D√©tail des Masques</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>R√©f√©rence</th>
                                <th>Mod√®le</th>
                                <th>Utilisateur</th>
                                <th>Date Expiration</th>
                                <th>Statut</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.masques.map(m => `
                                <tr>
                                    <td>${m.reference}</td>
                                    <td>${m.modele}</td>
                                    <td>${m.nomUtilisateur} ${m.prenomUtilisateur}</td>
                                    <td>${formatDate(m.dateExpiration)}</td>
                                    <td>${m.statut}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <div class="page-break"></div>
                    
                    <h2>üîß D√©tail des Tuyaux</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>R√©f√©rence</th>
                                <th>Mod√®le</th>
                                <th>Utilisateur</th>
                                <th>Date Expiration</th>
                                <th>Statut</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.tuyaux.map(t => `
                                <tr>
                                    <td>${t.reference}</td>
                                    <td>${t.modele}</td>
                                    <td>${t.nomUtilisateur} ${t.prenomUtilisateur}</td>
                                    <td>${formatDate(t.dateExpiration)}</td>
                                    <td>${t.statut}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <div class="page-break"></div>
                    
                    <h2>üîã D√©tail des Batteries</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>R√©f√©rence</th>
                                <th>Mod√®le</th>
                                <th>Utilisateur</th>
                                <th>Date Expiration</th>
                                <th>Statut</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.batteries.map(b => `
                                <tr>
                                    <td>${b.reference}</td>
                                    <td>${b.modele}</td>
                                    <td>${b.nomUtilisateur} ${b.prenomUtilisateur}</td>
                                    <td>${formatDate(b.dateExpiration)}</td>
                                    <td>${b.statut}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <div class="page-break"></div>
                    
                    <h2>‚öôÔ∏è D√©tail des Moteurs</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>R√©f√©rence</th>
                                <th>Mod√®le</th>
                                <th>Utilisateur</th>
                                <th>Date Expiration</th>
                                <th>Statut</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.moteurs.map(m => `
                                <tr>
                                    <td>${m.reference}</td>
                                    <td>${m.modele}</td>
                                    <td>${m.nomUtilisateur} ${m.prenomUtilisateur}</td>
                                    <td>${formatDate(m.dateExpiration)}</td>
                                    <td>${m.statut}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <script>
                        window.onload = function() {
                            window.print();
                        }
                    </script>
                </body>
                </html>
            `);
            
            printWindow.document.close();
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üîî NOTIFICATION SYSTEM
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function checkExpirations() {
            const today = new Date();
            let notifications = [];
            
            // Check all items
            [...data.masques, ...data.tuyaux, ...data.batteries, ...data.moteurs].forEach(item => {
                const expiration = new Date(item.dateExpiration);
                const daysRemaining = Math.floor((expiration - today) / (1000 * 60 * 60 * 24));
                
                if (daysRemaining === 30 || daysRemaining === 15 || daysRemaining === 7) {
                    notifications.push({
                        reference: item.reference,
                        daysRemaining
                    });
                }
            });
            
            return notifications;
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üé® THEME HELPERS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function getExpirationColor(daysRemaining) {
            if (daysRemaining < 0) return '#dc2626';
            if (daysRemaining <= 30) return '#ea580c';
            if (daysRemaining <= 90) return '#f59e0b';
            return '#16a34a';
        }

        function getStatusColor(statut) {
            const colors = {
                'en-service': '#3b82f6',
                'stock': '#16a34a',
                'maintenance': '#f59e0b',
                'hors-service': '#dc2626'
            };
            return colors[statut] || '#6b7280';
        }
    </script>
    <script>
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üé¨ INITIALIZATION & EVENT LISTENERS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // Initialize app on auth state change
        firebase.auth().onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                await loadUserData();
                await loadAllData();
                initializeApp();
                
                // Check for expiration notifications
                const notifications = checkExpirations();
                if (notifications.length > 0) {
                    showNotification(‚ö†Ô∏è ${notifications.length} √©quipement(s) n√©cessite(nt) votre attention`, 'warning');
                }
            } else {
                showLoginForm();
            }
        });

        // Initialize app components
        function initializeApp() {
            // Set active section to dashboard
            showSection('dashboard');
            
            // Update dashboard
            updateDashboard();
            
            // Adjust for mobile
            adjustForMobile();
            
            // Hide loading overlay
            hideLoading();
            
            // Show welcome notification
            showNotification(`üëã Bienvenue ${currentUserData?.prenom || 'Utilisateur'} !`, 'success');
            
            console.log('‚úÖ Application initialis√©e avec succ√®s');
        }

        // Setup form event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Setup search inputs with debounce
            ['masques', 'tuyaux', 'batteries', 'moteurs'].forEach(category => {
                const searchInput = document.getElementById(`search-${category}`);
                if (searchInput) {
                    let timeout;
                    searchInput.addEventListener('input', () => {
                        clearTimeout(timeout);
                        timeout = setTimeout(() => {
                            switch(category) {
                                case 'masques': displayMasques(); break;
                                case 'tuyaux': displayTuyaux(); break;
                                case 'batteries': displayBatteries(); break;
                                case 'moteurs': displayMoteurs(); break;
                            }
                        }, 300);
                    });
                }
            });

            // Setup filter change listeners
            document.querySelectorAll('select[id^="filter-"]').forEach(select => {
                select.addEventListener('change', () => {
                    const category = select.id.split('-')[1];
                    switch(category) {
                        case 'masque': displayMasques(); break;
                        case 'tuyau': displayTuyaux(); break;
                        case 'batterie': displayBatteries(); break;
                        case 'moteur': displayMoteurs(); break;
                    }
                });
            });

            console.log('‚úÖ Event listeners configur√©s');
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + K : Focus search
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                const activeSection = document.querySelector('.section.active');
                const searchInput = activeSection?.querySelector('input[type="text"]');
                if (searchInput) searchInput.focus();
            }
            
            // Escape : Close modals
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay').forEach(modal => modal.remove());
            }
        });

        // Auto-refresh data every 5 minutes
        setInterval(() => {
            if (currentUser) {
                loadAllData().then(() => {
                    console.log('üîÑ Donn√©es rafra√Æchies automatiquement');
                });
            }
        }, 5 * 60 * 1000);

        // Check for updates daily
        setInterval(() => {
            const notifications = checkExpirations();
            if (notifications.length > 0) {
                showNotification(`‚ö†Ô∏è ${notifications.length} √©quipement(s) n√©cessite(nt) votre attention`, 'warning');
            }
        }, 24 * 60 * 60 * 1000);

        // Service Worker registration for offline support
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Service worker would be registered here for PWA support
                console.log('üì± PWA support ready');
            });
        }

        // Handle online/offline events
        window.addEventListener('online', () => {
            showNotification('üåê Connexion r√©tablie', 'success');
            loadAllData();
        });

        window.addEventListener('offline', () => {
            showNotification('üì° Mode hors ligne', 'warning');
        });

        // Prevent accidental page close with unsaved changes
        let hasUnsavedChanges = false;

        window.addEventListener('beforeunload', (e) => {
            if (hasUnsavedChanges) {
                e.preventDefault();
                e.returnValue = '';
            }
        });

        // Console welcome message
        console.log('%cüî• Gestion EPI - Syst√®me de Gestion Complet', 'color: #3b82f6; font-size: 20px; font-weight: bold;');
        console.log('%c‚ú® D√©velopp√© avec Firebase & Vanilla JS', 'color: #10b981; font-size: 14px;');
        console.log('%cüìä Version 2.0 - D√©cembre 2024', 'color: #6b7280; font-size: 12px;');

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üéØ FINAL HELPER - ERROR BOUNDARY
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        window.addEventListener('error', (e) => {
            console.error('‚ùå Erreur globale:', e.error);
            showNotification('‚ùå Une erreur est survenue. Veuillez rafra√Æchir la page.', 'error');
        });

        window.addEventListener('unhandledrejection', (e) => {
            console.error('‚ùå Promise rejet√©e:', e.reason);
            showNotification('‚ùå Une erreur r√©seau est survenue.', 'error');
        });

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üèÅ APPLICATION READY
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        console.log('üöÄ Application charg√©e et pr√™te !');
        
        // Show initial loading
        showLoading('Initialisation de l\'application...');
    </script>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- üé® ADDITIONAL ANIMATIONS CSS -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <style>
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes slideDown {
            from {
                transform: translateY(-30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 10002;
            max-width: 400px;
            border-left: 4px solid #3b82f6;
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        .notification-success {
            border-left-color: #16a34a;
        }

        .notification-error {
            border-left-color: #dc2626;
        }

        .notification-warning {
            border-left-color: #f59e0b;
        }

        .notification-info {
            border-left-color: #3b82f6;
        }

        .loader {
            width: 48px;
            height: 48px;
            border: 4px solid #f3f4f6;
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Print styles */
        @media print {
            .sidebar,
            .top-bar,
            button,
            .btn-primary,
            .btn-secondary,
            .btn-danger {
                display: none !important;
            }

            .main-content {
                margin-left: 0 !important;
                padding: 20px !important;
            }

            .card {
                break-inside: avoid;
                page-break-inside: avoid;
            }
        }

        /* Focus styles for accessibility */
        *:focus {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }

        /* Selection color */
        ::selection {
            background: #3b82f6;
            color: white;
        }
    </style>

</body>
</html>
